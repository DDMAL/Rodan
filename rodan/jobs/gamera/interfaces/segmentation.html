{% extends "interface/base.html" %}

{% block resources %}
<script src="http://d3lp1msu2r81bx.cloudfront.net/kjs/js/lib/kinetic-v4.5.1.min.js"></script>
<script>
 {% include 'gamera/interfaces/assets/Stats.js' %}
</script>
<script>
 {% include 'gamera/interfaces/assets/show_stats.js' %}
</script>
<script>
 {% include 'gamera/interfaces/assets/RKSegment.js' %}
</script>
{% endblock %}


{% block body %}
<div style="padding: 1em; overflow: hidden; min-width: 1450px">
  <div style="float: left; width: 350px; margin: 1em">
    <h2>Segmentation Interface</h2>
    <p>Select a polygon or anchor by clicking on it, then use the mouse to drag it to a new position.
      <br/>
      <br/>
        With a polygon selected, you can:<br/>
        - delete it (d, Delete key, Backspace key)<br/>
        - transform it to a rectangle (r)<br/>
        - add an anchor (Alt key and mouse click)<br/>
      <br/>
        With an anchor selected, you can:<br/>
        - delete it (d, Delete key, Backspace key)<br/>
      <br/>
        You can create a new polygon by pressing n (no other polygon must be selected).
    </p>
    <div style="margin-bottom: 1em;">
      <button id="submit">Segment</button>
    </div>
  </div>
  <div id="segment-view" style="border: 2px solid; margin: 1em; float: left">
  </div>
</div>
<script type="text/javascript">
 $(document).ready(function() {
   $("#segment-view").RKSegment(
     {
       image: "{{ image_url }}",
       polyPoints: {{ polygon_outer_points }},
       originalWidth: {{ image_width }}
     });
   var rks = $("#segment-view").data('RKSegment');

   $('#submit').click(function () {
     $.ajax({
       url: '',
       type: 'POST',
       data: JSON.stringify({'polygon_outer_points': rks.getPolyPoints()}),
       contentType: 'application/json',
       complete: function () {
         window.close();
       }
     });
   });
 });
</script>
{% endblock %}
