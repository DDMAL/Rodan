{% extends "base.html" %}

{% block resources %}
<script src="http://d3lp1msu2r81bx.cloudfront.net/kjs/js/lib/kinetic-v5.0.1.min.js"></script>
<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script>{% include 'gamera/interfaces/assets/RKPixelSegment.js' %}</script>
{% endblock %}

{% block body %}
{% csrf_token %}
<div style="padding: 1em; overflow: hidden; min-width: 1450px">
    <div id="ui" style="float: left; width: 400px; margin-right: 5px; padding: 5px; background-color: #EEEEEE; border: 2px solid black; font-family: arial; font-size: 10pt;">
        <div style="float: left; font-size: 16pt; width: 100%">Pixel Segmentation</div><br/>
            <div>
            <hr style="background: #333333; border:0; height:2px" />
            <table>
                <tbody>
                    <tr>
                        <th>State</th>
                        <td id="state"></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div>
            <input type="submit" name="submit" value="Submit" class="submit" />
        </div>
    </div>
    <div id="container" style="float: left; border: 1px solid black; min-width: 1050px"></div>
    <input type="hidden" name="geometries" value="" id="JSON-input" />
</div>
<script type="text/javascript">
    $(document).ready(function()
    {
        var options = {image: {source: "{{ image_url }}", originalWidth: {{ image_width }}}};
        $("#container").PixelSegmentation(options);
        var instance = $("#container").data('PixelSegmentation');
        $('#form').submit(function()
        {
            $('#JSON-input').val(function()
            {
                var geometries = instance.getGeometries();
                return JSON.stringify(geometries);
            });
        });
    });
</script>
{% endblock %}
