!function(t){var e={};function a(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=t,a.c=e,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)a.d(n,i,function(e){return t[e]}.bind(null,i));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=18)}({18:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}(),i=a(19);function r(t,e,a){var n=void 0;return function(){var i=this,r=arguments,o=a&&!n;clearTimeout(n),n=setTimeout(function(){n=null,a||t.apply(i,r)},e),o&&t.apply(i,r)}}var o=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._core=e,this.pageToolsIcon=this.createIcon(),this._backdrop=null,this._page=null,this._mainImage=null,this._canvas=null,this._filters={brightness:null,contrast:null},this._originalData=null,this.boundEscapeListener=this.escapeListener.bind(this)}return n(t,[{key:"handleClick",value:function(t,e,a,n){document.body.style.overflow="hidden",this._backdrop=document.createElement("div"),this._backdrop.classList.add("manipulation-fullscreen"),this._sidebar=document.createElement("div"),this._sidebar.classList.add("manipulation-sidebar"),this._mainArea=document.createElement("div"),this._mainArea.classList.add("manipulation-main-area"),this._tools=document.createElement("div"),this._tools.classList.add("manipulation-tools"),this._backdrop.appendChild(this._sidebar),this._backdrop.appendChild(this._mainArea),this._backdrop.appendChild(this._tools),this._core.parentObject.appendChild(this._backdrop),document.addEventListener("keyup",this.boundEscapeListener),this._page=e.manifest.pages[n],this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d"),this._mainArea.appendChild(this._canvas),this._initializeSidebar(),this._initializeTools()}},{key:"createIcon",value:function(){var t=document.createElement("div");t.classList.add("diva-manipulation-icon");var e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("x","0px"),e.setAttribute("y","0px"),e.setAttribute("viewBox","0 0 25 25"),e.id=this._core.settings.selector+"manipulation-icon";var a=document.createElementNS("http://www.w3.org/2000/svg","g");a.id=this._core.settings.selector+"manipulation-icon-glyph",a.setAttribute("transform","matrix(1, 0, 0, 1, -11.5, -11.5)"),a.setAttribute("class","diva-pagetool-icon");var n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d","M27,21h-1v-9h-3v9h-1c-0.55,0-1,0.45-1,1v3c0,0.55,0.45,1,1,1h1h3h1c0.55,0,1-0.45,1-1v-3C28,21.45,27.55,21,27,21z M27,24h-5v-0.5h5V24z");var i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d","M35,16h-1v-4h-3v4h-1c-0.55,0-1,0.45-1,1v3c0,0.55,0.45,1,1,1h1h3h1c0.55,0,1-0.45,1-1v-3C36,16.45,35.55,16,35,16z M35,19h-5v-0.5h5V19z");var r=document.createElementNS("http://www.w3.org/2000/svg","path");r.setAttribute("d","M19,26h-1V12h-3v14h-1c-0.55,0-1,0.45-1,1v3c0,0.55,0.45,1,1,1h1h3h1c0.55,0,1-0.45,1-1v-3C20,26.45,19.55,26,19,26zM19,29h-5v-0.5h5V29z");var o=document.createElementNS("http://www.w3.org/2000/svg","rect");o.setAttribute("x","23"),o.setAttribute("y","27"),o.setAttribute("width","3"),o.setAttribute("height","9");var s=document.createElementNS("http://www.w3.org/2000/svg","rect");s.setAttribute("x","31"),s.setAttribute("y","22"),s.setAttribute("width","3"),s.setAttribute("height","14");var u=document.createElementNS("http://www.w3.org/2000/svg","rect");return u.setAttribute("x","15"),u.setAttribute("y","32"),u.setAttribute("width","3"),u.setAttribute("height","4"),a.appendChild(n),a.appendChild(i),a.appendChild(o),a.appendChild(r),a.appendChild(s),a.appendChild(u),e.appendChild(a),t.appendChild(e),t}},{key:"escapeListener",value:function(t){27===t.keyCode&&(document.removeEventListener("keyup",this.boundEscapeListener),document.body.style.overflow="auto",this._core.parentObject.removeChild(this._backdrop))}},{key:"_initializeSidebar",value:function(){var t=this,e=this._page.url+"full/150,/0/default.jpg",a=this._page.otherImages.map(function(t){return t.url+"full/150,/0/default.jpg"}),n=document.createElement("div");n.classList.add("manipulation-sidebar-primary-image");var i=document.createElement("img");i.setAttribute("src",e);var r=document.createElement("div");r.textContent=this._page.il,n.appendChild(i),n.appendChild(r),this._sidebar.appendChild(n),n.addEventListener("click",function(){t._loadImageInMainArea.call(t,event,t._page.url)}),a.map(function(e,a){var n=document.createElement("div");n.classList.add("manipulation-sidebar-secondary-image");var i=document.createElement("img");i.setAttribute("src",e);var r=document.createElement("div");r.textContent=t._page.otherImages[a].il,n.appendChild(i),n.appendChild(r),t._sidebar.appendChild(n),n.addEventListener("click",function(){return t._loadImageInMainArea.call(t,event,t._page.otherImages[a].url)})})}},{key:"_initializeTools",value:function(){var t=this,e=document.createElement("div"),a=document.createElement("button");a.textContent="Grayscale",a.addEventListener("click",function(e){return t._applyTransformationToImageData(e,i.grayscale)}),e.appendChild(a);var n=document.createElement("div"),o=document.createElement("input");o.setAttribute("type","range"),o.setAttribute("max",100),o.setAttribute("min",-100),o.setAttribute("value",0),o.addEventListener("change",r(function(e){return t._applyTransformationToImageData(e,i.vibrance,e.target.value)},250)),n.appendChild(o);var s=document.createElement("div"),u=document.createElement("input");u.setAttribute("type","range"),u.setAttribute("max",100),u.setAttribute("min",-100),u.setAttribute("value",0),u.addEventListener("change",r(function(e){return t._applyTransformationToImageData(e,i.brightness,e.target.value)},250)),s.appendChild(u);var c=document.createElement("div"),l=document.createElement("input");l.setAttribute("type","range"),l.setAttribute("max",100),l.setAttribute("min",-100),l.setAttribute("value",0),l.addEventListener("change",r(function(e){return t._applyTransformationToImageData(e,i.contrast,e.target.value)},250)),c.appendChild(l);var d=document.createElement("div"),h=document.createElement("button");h.textContent="Invert Colours",h.addEventListener("click",function(e){return t._applyTransformationToImageData(e,i.invert)}),d.appendChild(h);var p=document.createElement("div"),v=document.createElement("input");v.setAttribute("type","range"),v.setAttribute("max",255),v.setAttribute("min",64),v.setAttribute("value",0),v.addEventListener("change",r(function(e){return t._applyTransformationToImageData(e,i.threshold,e.target.value)},250)),p.appendChild(v);var m=document.createElement("div"),g=document.createElement("input");g.setAttribute("type","range"),g.setAttribute("max",100),g.setAttribute("min",0),g.setAttribute("value",0),g.addEventListener("change",r(function(e){return t._applyConvolutionFilter(e,i.sharpen,e.target.value)},250)),m.appendChild(g);var f=document.createElement("div"),_=document.createElement("input");_.setAttribute("type","range"),_.setAttribute("max",100),_.setAttribute("min",0),_.setAttribute("value",0),_.addEventListener("change",r(function(e){return t._applyConvolutionFilter(e,i.hue,e.target.value)},250)),f.appendChild(_),this._tools.appendChild(e),this._tools.appendChild(d),this._tools.appendChild(n),this._tools.appendChild(s),this._tools.appendChild(c),this._tools.appendChild(p),this._tools.appendChild(m),this._tools.appendChild(f)}},{key:"_loadImageInMainArea",value:function(t,e){var a=this,n=e+"full/full/0/default.jpg";this._mainImage=new Image,this._mainImage.crossOrigin="anonymous",this._mainImage.addEventListener("load",function(){a._canvas.size=Math.sqrt(a._mainImage.width*a._mainImage.width+a._mainImage.height*a._mainImage.height),a._canvas.width=a._mainImage.width,a._canvas.height=a._mainImage.height,a._canvas.cornerX=(a._canvas.size-a._mainImage.width)/2,a._canvas.cornerY=(a._canvas.size-a._mainImage.height)/2,a._ctx.clearRect(0,0,a._canvas.width,a._canvas.height),a._ctx.drawImage(a._mainImage,0,0,a._canvas.width,a._canvas.height),a._originalData=a._ctx.getImageData(0,0,a._canvas.width,a._canvas.height),a._mainImage=null}),this._mainImage.src=n}},{key:"_applyTransformationToImageData",value:function(t,e,a){var n=this._canvas.width,i=this._canvas.height,r=void 0;a&&(r=parseInt(a,10));var o=e(this._originalData,r);this._ctx.clearRect(0,0,n,i),this._ctx.putImageData(o,0,0)}},{key:"_applyConvolutionFilter",value:function(t,e,a){var n=this._canvas.width,i=this._canvas.height,r=void 0;a&&(r=parseInt(a,10));var o=e(this._originalData,r);this._ctx.clearRect(0,0,n,i),this._ctx.putImageData(o,0,0)}}]),t}();e.default=o,o.prototype.pluginName="manipulation",o.prototype.isPageTool=!0,window.Diva.ManipulationPlugin=o},19:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.addFilterToQueue=function(t){var e=t.name;n.hasOwnProperty(e)},e.grayscale=function(t){return r(t,o)},e.vibrance=function(t,e){return r(t,s,e)},e.brightness=function(t,e){return r(t,u,e)},e.contrast=function(t,e){return r(t,c,e)},e.invert=function(t){return r(t,l)},e.threshold=function(t,e){return r(t,d,e)},e.hue=function(t,e){return r(t,h,e)},e.rgbToHSV=p,e.hsvToRGB=v,e.sharpen=function(t,e){var a=e||100;return function(t,e,a){for(var n=Math.round(Math.sqrt(e.length)),r=Math.floor(n/2),o=t.data,s=t.width,u=t.height,c=s,l=u,d=i(c,l),h=d.data,p=a?1:0,v=0;v<l;v++)for(var m=0;m<c;m++){for(var g=v,f=m,_=4*(v*c+m),b=0,y=0,w=0,A=0,E=0;E<n;E++)for(var C=0;C<n;C++){var I=g+E-r,x=f+C-r;if(I>=0&&I<u&&x>=0&&x<s){var k=4*(I*s+x),M=e[E*n+C];b+=o[k]*M,y+=o[k+1]*M,w+=o[k+2]*M,A+=o[k+3]*M}}h[_]=b,h[_+1]=y,h[_+2]=w,h[_+3]=A+p*(255-A)}return d}(t,[0,-(a/=100),0,-a,4*a+1,-a,0,-a,0])};var n={};function i(t,e){return document.createElement("canvas").getContext("2d").createImageData(t,e)}function r(t,e,a){var n=function(t,e,a){for(var n=t.length,i=0;i<n;i+=4){var r=e(t[i],t[i+1],t[i+2],a);t[i]=r[0],t[i+1]=r[1],t[i+2]=r[2],t[i+3]=r[3]}return t}(new Uint8ClampedArray(t.data),e,a),r=i(t.width,t.height);return r.data.set(n),r}function o(t,e,a){var n=.3*t+.59*e+.11*a;return[n,n,n,255]}function s(t,e,a,n){var i=-1*n,r=Math.max(t,e,a),o=t+e+a/3,s=2*Math.abs(r-o)/255*i/100;return[t!==r?t+(r-t)*s:t,e!==r?e+(r-e)*s:e,a!==r?a+(r-a)*s:a,255]}function u(t,e,a,n){var i=Math.floor(n/100*255);return[t+i,e+i,a+i,255]}function c(t,e,a,n){var i=Math.pow((n+100)/100,2),r=t,o=e,s=a;return r/=255,r-=.5,r*=i,r+=.5,o/=255,o-=.5,o*=i,o+=.5,s/=255,s-=.5,s*=i,s+=.5,[r*=255,o*=255,s*=255,255]}function l(t,e,a){return[255-t,255-e,255-a,255]}function d(t,e,a,n){var i=.2126*t+.7152*e+.0722*a>=n?255:0;return[i,i,i,255]}function h(t,e,a,n){var i=p(t,e,a),r=i.h,o=i.s,s=i.v;r*=100,r+=Math.abs(n),r%=100;var u=v(r/=100,o,s);return[u.r,u.g,u.b,255]}function p(t,e,a){var n=t,i=e,r=a;n/=255,i/=255,r/=255;var o=Math.max(n,i,r),s=Math.min(n,i,r),u=o,c=o-s,l=0===o?0:c/o,d=void 0;if(o===s)d=0;else{switch(o){case n:d=(i-r)/c+(i<r?6:0);break;case i:d=(r-n)/c+2;break;case r:d=(n-i)/c+4}d/=6}return{h:d,s:l,v:u}}function v(t,e,a){var n,i,r,o,s,u=void 0,c=void 0,l=void 0;switch(r=a*(1-e),o=a*(1-(n=6*t-(i=Math.floor(6*t)))*e),s=a*(1-(1-n)*e),i%6){case 0:l=a,c=s,u=r;break;case 1:l=o,c=a,u=r;break;case 2:l=r,c=a,u=s;break;case 3:l=r,c=o,u=a;break;case 4:l=s,c=r,u=a;break;case 5:l=a,c=r,u=o}return{r:Math.floor(255*l),g:Math.floor(255*c),b:Math.floor(255*u)}}}});