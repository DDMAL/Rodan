!function(e){var t={};function a(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=t,a.d=function(e,t,i){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(i,n,function(t){return e[t]}.bind(null,n));return i},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=5)}([function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}();t.Point=function(){function e(t,a,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.relativeOriginX=t,this.relativeOriginY=a,this.pageIndex=i}return i(e,[{key:"getCoordsInPage",value:function(e){var t=Math.pow(2,e);return{x:this.relativeOriginX*t,y:this.relativeOriginY*t}}},{key:"getCoordsInViewport",value:function(e,t,a){var i=Math.max(0,(a._viewport.width-a.layout.dimensions.width)/2),n=Math.max(0,(a._viewport.height-a.layout.dimensions.height)/2),r=this.getCoordsInPage(e);return{x:a._getImageOffset(t).left-a._viewport.left+i+r.x,y:a._getImageOffset(t).top-a._viewport.top+n+r.y}}},{key:"getAbsoluteCoordinatesFromPadded",value:function(e,t,a,i){var n=Math.max(0,(t._viewport.width-t.layout.dimensions.width)/2),r=Math.max(0,(t._viewport.height-t.layout.dimensions.height)/2);return{x:Math.round(a-(t._getImageOffset(e).left-t._viewport.left+n)),y:Math.round(i-(t._getImageOffset(e).top-t._viewport.top+r))}}},{key:"getPaddedCoordinatesFromAbsolute",value:function(e,t,a,i){var n=Math.max(0,(t._viewport.width-t.layout.dimensions.width)/2),r=Math.max(0,(t._viewport.height-t.layout.dimensions.height)/2);return{x:t._getImageOffset(e).left-t._viewport.left+n+a,y:t._getImageOffset(e).top-t._viewport.top+r+i}}},{key:"getRelativeCoordinatesFromPadded",value:function(e,t,a,i,n){var r=Math.pow(2,n),s=Math.max(0,(t._viewport.width-t.layout.dimensions.width)/2),o=Math.max(0,(t._viewport.height-t.layout.dimensions.height)/2);return{x:(a-t._getImageOffset(e).left+t._viewport.left-s)/r,y:(i-t._getImageOffset(e).top+t._viewport.top-o)/r}}}]),e}()},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}();t.Colour=function(){function e(t,a,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.red=t,this.green=a,this.blue=i,this.alpha=n}return i(e,[{key:"toHTMLColour",value:function(){return"rgba("+this.red+", "+this.green+", "+this.blue+", "+this.alpha+")"}},{key:"toHexString",value:function(){var e="#",t=this.red.toString(16),a=this.green.toString(16),i=this.blue.toString(16);return 1===t.length&&(e=e.concat("0")),e=e.concat(t),1===a.length&&(e=e.concat("0")),e=e.concat(a),1===i.length&&(e=e.concat("0")),e=e.concat(i)}},{key:"isSimilarTo",value:function(e,t){return e.red>=this.red-t&&e.red<=this.red+t&&(e.blue>=this.blue-t&&e.blue<=this.blue+t&&(e.green>=this.green-t&&e.green<=this.green+t))}}]),e}()},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Rectangle=void 0;var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}(),n=a(8),r=a(1),s=a(0);t.Rectangle=function(e){function t(e,a,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return r.relativeRectWidth=a,r.relativeRectHeight=i,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.Shape),i(t,[{key:"drawInViewport",value:function(e,t,a,i,n){var r=Math.pow(2,a),s=n.getContext("2d"),o=Math.max(0,(i._viewport.width-i.layout.dimensions.width)/2),l=Math.max(0,(i._viewport.height-i.layout.dimensions.height)/2),c=this.origin.relativeOriginX*r,d=this.origin.relativeOriginY*r,u=this.relativeRectWidth*r,h=this.relativeRectHeight*r;if("select"!==this.blendMode){if("add"===this.blendMode){if(t===this.origin.pageIndex){var y=i._getImageOffset(t).left-i._viewport.left+o+c,g=i._getImageOffset(t).top-i._viewport.top+l+d;s.fillStyle=e.colour.toHTMLColour(),s.fillRect(y,g,u,h)}}else if("subtract"===this.blendMode&&t===this.origin.pageIndex){var p=i._getImageOffset(t).left-i._viewport.left+o+c,v=i._getImageOffset(t).top-i._viewport.top+l+d;s.fillStyle=e.colour.toHTMLColour(),s.clearRect(p,v,u,h)}}else if(t===this.origin.pageIndex){var m=i._getImageOffset(t).left-i._viewport.left+o+c,b=i._getImageOffset(t).top-i._viewport.top+l+d;s.fillStyle="rgba(147, 192, 255, 0.3)",s.lineWidth=1,s.strokeStyle="rgba(25, 25, 25, 1)",s.fillRect(m,b,u,h),s.strokeRect(m,b,u,h)}}},{key:"drawOnPage",value:function(e,t,a,i,n){var r=Math.pow(2,a),s=n.getContext("2d"),o=this.origin.relativeOriginX*r,l=this.origin.relativeOriginY*r,c=this.relativeRectWidth*r,d=this.relativeRectHeight*r;"select"===this.blendMode?t===this.origin.pageIndex&&(s.fillStyle="rgba(147, 192, 255, 0.5)",s.lineWidth=30/r,s.strokeStyle="rgba(97, 142, 205, 1)",s.fillRect(o,l,c,d),s.strokeRect(o,l,c,d)):"add"===this.blendMode?t===this.origin.pageIndex&&-1===e.layerId?(s.fillStyle=e.colour.toHTMLColour(),s.lineWidth=1,s.strokeStyle="rgba(0, 0, 0, 1)",s.fillRect(o,l,c,d),s.strokeRect(o,l,c,d)):t===this.origin.pageIndex&&(s.fillStyle=e.colour.toHTMLColour(),s.fillRect(o,l,c,d)):"subtract"===this.blendMode&&t===this.origin.pageIndex&&(s.fillStyle=e.colour.toHTMLColour(),s.clearRect(o,l,c,d))}},{key:"getPixels",value:function(e,t,a,i,n,o){var l=Math.pow(2,a),c=n.getContext("2d"),d=o.getContext("2d"),u=this.origin.relativeOriginX*l,h=this.origin.relativeOriginY*l,y=this.relativeRectWidth*l,g=this.relativeRectHeight*l;if(t===this.origin.pageIndex)for(var p=Math.round(Math.min(h,h+g));p<Math.max(h,h+g);p++)for(var v=Math.round(Math.min(u,u+y));v<Math.max(u,u+y);v++)if(p>=0&&v>=0&&p<n.height&&v<n.width)if("add"===this.blendMode){var m=(new s.Point).getPaddedCoordinatesFromAbsolute(t,i,v,p),b=d.getImageData(m.x,m.y,1,1).data,f=new r.Colour(b[0],b[1],b[2],b[3]),x=v/l*Math.pow(2,5),k=p/l*Math.pow(2,5);c.fillStyle=f.toHTMLColour(),c.fillRect(x,k,Math.pow(2,5),Math.pow(2,5))}else"subtract"===this.blendMode&&c.clearRect(v,p,1,1)}}]),t}()},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Layer=void 0;var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}(),n=a(9),r=a(0),s=a(10);t.Layer=function(){function e(t,a,i,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.layerId=t,this.shapes=[],this.paths=[],this.colour=a,this.layerName=i,this.canvas=null,this.ctx=null,this.actions=[],this.activated=!0,this.layerOpacity=r,this.pixelInstance=n,this.pageIndex=this.pixelInstance.core.getSettings().currentPageIndex,this.backgroundImageCanvas=null,this.pastedRegions=[],this.cloneCanvas()}return i(e,[{key:"cloneCanvas",value:function(){var e=this.pixelInstance.core.getSettings().maxZoomLevel,t=this.pixelInstance.core.publicInstance.getPageDimensionsAtZoomLevel(this.pageIndex,e).height,a=this.pixelInstance.core.publicInstance.getPageDimensionsAtZoomLevel(this.pageIndex,e).width;this.canvas=document.createElement("canvas"),this.canvas.setAttribute("class","pixel-canvas"),this.canvas.setAttribute("id","layer-"+this.layerId+"-canvas"),this.canvas.width=a,this.canvas.height=t,this.ctx=this.canvas.getContext("2d"),this.resizeLayerCanvasToZoomLevel(this.pixelInstance.core.getSettings().zoomLevel),this.placeLayerCanvasOnTopOfEditingPage(),this.backgroundImageCanvas=document.createElement("canvas"),this.backgroundImageCanvas.width=this.canvas.width,this.backgroundImageCanvas.height=this.canvas.height}},{key:"resizeLayerCanvasToZoomLevel",value:function(e){var t=Math.floor(e),a=e-t,i=Math.pow(2,a),n=this.pixelInstance.core.publicInstance.getPageDimensionsAtZoomLevel(this.pageIndex,t).height,r=this.pixelInstance.core.publicInstance.getPageDimensionsAtZoomLevel(this.pageIndex,t).width;r*=i,n*=i,this.canvas.style.width=r+"px",this.canvas.style.height=n+"px",this.placeLayerCanvasOnTopOfEditingPage(),null!==this.pixelInstance.uiManager&&this.pixelInstance.uiManager.resizeBrushCursor()}},{key:"placeLayerCanvasOnTopOfEditingPage",value:function(){var e=this.pixelInstance.core.getSettings().zoomLevel,t=new r.Point(0,0,0).getCoordsInViewport(e,this.pageIndex,this.pixelInstance.core.getSettings().renderer);this.canvas.style.left=t.x+"px",this.canvas.style.top=t.y+"px"}},{key:"placeCanvasAfterElement",value:function(e){e.parentNode.insertBefore(this.canvas,e.nextSibling)}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCtx",value:function(){return this.ctx}},{key:"clearCtx",value:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}},{key:"updateLayerName",value:function(e){this.layerName=e}},{key:"addShapeToLayer",value:function(e){this.shapes.push(e),this.addAction(new s.Action(e,this))}},{key:"addPathToLayer",value:function(e){this.paths.push(e),this.addAction(new s.Action(e,this))}},{key:"addToCurrentPath",value:function(e,t){0===this.paths.length&&this.createNewPath(this.pixelInstance.uiManager.getBrushSizeSelectorValue(),t),this.paths[this.paths.length-1].addPointToPath(e)}},{key:"getCurrentPath",value:function(){return this.paths.length>0?this.paths[this.paths.length-1]:null}},{key:"createNewPath",value:function(e,t){var a=new n.Path(e,t);this.paths.push(a),this.addAction(new s.Action(a,this))}},{key:"removePathFromLayer",value:function(e){var t=this,a=this.paths.indexOf(e);this.paths.splice(a,1),this.actions.forEach(function(a){a.object===e&&t.removeAction(a)})}},{key:"removeShapeFromLayer",value:function(e){var t=this,a=this.shapes.indexOf(e);this.shapes.splice(a,1),this.actions.forEach(function(a){a.object===e&&t.removeAction(a)})}},{key:"removeSelectionFromLayer",value:function(e){var t=this,a=this.pastedRegions.indexOf(e);this.pastedRegions.splice(a,1),this.actions.forEach(function(a){a.object===e&&t.removeAction(a)})}},{key:"setOpacity",value:function(e){this.colour.alpha=e}},{key:"getOpacity",value:function(){return this.colour.alpha}},{key:"getCurrentShape",value:function(){return this.shapes.length>0?this.shapes[this.shapes.length-1]:null}},{key:"isActivated",value:function(){return this.activated}},{key:"setLayerOpacity",value:function(e){this.layerOpacity=e}},{key:"getLayerOpacity",value:function(){return this.layerOpacity}},{key:"getLayerOpacityCSSString",value:function(){return"opacity : "+this.layerOpacity}},{key:"drawLayer",value:function(e,t){this.isActivated()&&this.drawLayerInPageCoords(e,t,this.pageIndex)}},{key:"drawLayerInPageCoords",value:function(e,t,a){var i=this,n=t.getContext("2d");n.clearRect(0,0,t.width,t.height),null!==this.backgroundImageCanvas&&n.drawImage(this.backgroundImageCanvas,0,0),this.actions.forEach(function(n){n.object.drawOnPage(i,a,e,i.pixelInstance.core.getSettings().renderer,t)})}},{key:"setBackgroundImageCanvas",value:function(e){this.backgroundImageCanvas=e}},{key:"addToPastedRegions",value:function(e){this.pastedRegions.push(e),this.addAction(new s.Action(e,this))}},{key:"addAction",value:function(e){this.actions.push(e),"selection"===e.object.type&&"select"===e.object.selectedShape.blendMode||this.pixelInstance.actions.push(e)}},{key:"removeAction",value:function(e){var t=this.actions.indexOf(e);this.actions.splice(t,1);var a=this.pixelInstance.actions.indexOf(e);this.pixelInstance.actions.splice(a,1)}},{key:"displayColourOptions",value:function(){console.log("colour clicked here")}},{key:"displayLayerOptions",value:function(){var e=document.getElementById("layer-"+this.layerId+"-options");e.classList.contains("unchecked-layer-settings")?(e.classList.remove("unchecked-layer-settings"),e.classList.add("checked-layer-settings"),this.pixelInstance.uiManager.createOpacitySlider(this,e.parentElement.parentElement,e.parentElement)):(e.classList.remove("checked-layer-settings"),e.classList.add("unchecked-layer-settings"),this.pixelInstance.uiManager.destroyOpacitySlider(this))}},{key:"activateLayer",value:function(){var e=document.getElementById("layer-"+this.layerId+"-activation");e.classList.remove("layer-deactivated"),e.classList.add("layer-activated"),this.getCanvas().style.opacity=this.getLayerOpacity(),this.layerId===this.pixelInstance.background.layerId?this.activated=!0:(this.activated=!0,this.pixelInstance.redrawLayer(this))}},{key:"deactivateLayer",value:function(){var e=document.getElementById("layer-"+this.layerId+"-activation");e.classList.remove("layer-activated"),e.classList.add("layer-deactivated"),this.activated=!1,this.layerId===this.pixelInstance.background.layerId?this.getCanvas().style.opacity=0:this.clearCtx()}},{key:"toggleLayerActivation",value:function(){document.getElementById("layer-"+this.layerId+"-activation").classList.contains("layer-deactivated")?this.activateLayer():this.deactivateLayer()}}]),e}()},function(e,t,a){"use strict";function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function e(t){r(this,e),this.message=t};t.CannotDeleteLayerException=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return n(t,s),t}(),t.CannotSelectLayerException=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return n(t,s),t}()},function(e,t,a){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}(),n=a(7),r=a(0),s=a(2),o=a(3),l=a(1),c=a(11),d=a(12),u=a(13),h=a(14),y=a(15),g=a(16),p=a(4);var v=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.pixelWrapper=null,this.core=e,this.activated=!1,this.pageToolsIcon=this.createIcon(),this.scrollEventHandle=null,this.zoomEventHandle=null,this.mouseHandles=null,this.keyboardHandles=null,this.background=null,this.layers=null,this.mousePressed=!1,this.rightMousePressed=!1,this.selectedLayerIndex=0,this.layerChangedMidDraw=!1,this.actions=[],this.undoneActions=[],this.shiftDown=!1,this.initialShiftPress=!0,this.lastRelCoordX=null,this.lastRelCoordY=null,this.uiManager=null,this.tools=null,this.selection=null,this.horizontalMove=!1,this.layerIdCounter=2}return i(t,[{key:"handleClick",value:function(){this.activated?this.deactivatePlugin():this.activatePlugin()}},{key:"activatePlugin",value:function(){if(null===this.layers){var e=new o.Layer(0,new l.Colour(242,242,242,1),"Background",this,1),t=new o.Layer(1,new l.Colour(51,102,255,1),"Layer 1",this,.5);this.layers=[t],this.background=e,this.background.canvas=this.core.getSettings().renderer._canvas}null===this.uiManager&&(this.uiManager=new d.UIManager(this)),null===this.tools&&(this.tools=new u.Tools(this)),this.uiManager.createPluginElements(this.layers),this.scrollEventHandle=this.subscribeToScrollEvent(),this.zoomEventHandle=this.subscribeToZoomLevelWillChangeEvent(),this.disableDragScrollable(),this.subscribeToWindowResizeEvent(),this.subscribeToMouseEvents(),this.subscribeToKeyboardEvents(),this.tools.setCurrentTool(this.tools.getCurrentTool()),this.activated=!0,new g.Tutorial,null===this.pixelWrapper&&(this.pixelWrapper=new n.PixelWrapper(this)),this.pixelWrapper.activate()}},{key:"deactivatePlugin",value:function(){this.pixelWrapper.deactivate(),e.Diva.Events.unsubscribe(this.scrollEventHandle),e.Diva.Events.unsubscribe(this.zoomEventHandle),this.unsubscribeFromMouseEvents(),this.unsubscribeFromKeyboardEvents(),this.redrawAllLayers(),this.uiManager.destroyPluginElements(this.layers,this.background),this.enableDragScrollable(),this.activated=!1}},{key:"enableDragScrollable",value:function(){this.core.viewerState.viewportObject.hasAttribute("nochilddrag")&&this.core.viewerState.viewportObject.removeAttribute("nochilddrag")}},{key:"disableDragScrollable",value:function(){this.core.viewerState.viewportObject.hasAttribute("nochilddrag")||this.core.viewerState.viewportObject.setAttribute("nochilddrag","")}},{key:"createIcon",value:function(){var e=document.createElement("div");e.classList.add("diva-pixel-icon");var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("x","0px"),t.setAttribute("y","0px"),t.setAttribute("viewBox","0 0 25 25"),t.id=this.core.settings.selector+"pixel-icon";var a=document.createElementNS("http://www.w3.org/2000/svg","g");a.id=this.core.settings.selector+"pixel-icon-glyph",a.setAttribute("transform","matrix(1, 0, 0, 1, -11.5, -11.5)"),a.setAttribute("class","diva-pagetool-icon");var i=document.createElementNS("http://www.w3.org/2000/svg","rect");return i.setAttribute("x","15"),i.setAttribute("y","10"),i.setAttribute("width","25"),i.setAttribute("height","25"),a.appendChild(i),t.appendChild(a),e.appendChild(t),e}},{key:"subscribeToWindowResizeEvent",value:function(){var e=this;window.addEventListener("resize",function(){e.layers.forEach(function(e){e.placeLayerCanvasOnTopOfEditingPage()})})}},{key:"subscribeToZoomLevelWillChangeEvent",value:function(){var t=this;return e.Diva.Events.subscribe("ZoomLevelWillChange",function(e){t.layers.forEach(function(t){t.resizeLayerCanvasToZoomLevel(e)})})}},{key:"subscribeToScrollEvent",value:function(){var t=this;return e.Diva.Events.subscribe("ViewerDidScroll",function(){t.layers.forEach(function(e){e.placeLayerCanvasOnTopOfEditingPage()})})}},{key:"subscribeToMouseEvents",value:function(){var e=this,t=document.getElementById("diva-1-outer");this.uiManager.createBrushCursor(),this.mouseDown=function(t){e.onMouseDown(t)},this.mouseUp=function(t){e.onMouseUp(t)},this.mouseMove=function(t){e.onMouseMove(t)},t.addEventListener("mousedown",this.mouseDown),t.addEventListener("mouseup",this.mouseUp),t.addEventListener("mouseleave",this.mouseUp),t.addEventListener("mousemove",this.mouseMove),this.mouseHandles={mouseDownHandle:this.mouseDown,mouseMoveHandle:this.mouseMove,mouseUpHandle:this.mouseUp}}},{key:"subscribeToKeyboardEvents",value:function(){var e=this;this.handleKeyUp=function(t){e.onKeyUp(t)},this.handleKeyDown=function(t){e.onKeyDown(t)},document.addEventListener("keyup",this.handleKeyUp),document.addEventListener("keydown",this.handleKeyDown),this.keyboardHandles={keyup:this.handleKeyUp,keydown:this.handleKeyDown}}},{key:"unsubscribeFromMouseEvents",value:function(){var e=document.getElementById("diva-1-outer");e.removeEventListener("mousedown",this.mouseHandles.mouseDownHandle),e.removeEventListener("mouseup",this.mouseHandles.mouseUpHandle),e.removeEventListener("mouseleave",this.mouseHandles.mouseUpHandle),e.removeEventListener("mousemove",this.mouseHandles.mouseMoveHandle)}},{key:"unsubscribeFromKeyboardEvents",value:function(){document.removeEventListener("keyup",this.keyboardHandles.keyup),document.removeEventListener("keydown",this.keyboardHandles.keydown)}},{key:"dragStart",value:function(e){e.dataTransfer.setData("Text",e.target.id)}},{key:"dragging",value:function(){}},{key:"allowDrop",value:function(e){e.preventDefault()}},{key:"drop",value:function(e,t,a){e.preventDefault(),this.reorderLayers(t,a)}},{key:"reorderLayers",value:function(e,t){var a=this.layers[e];if(e>t){for(var i=1;i<=e-t;i++)this.layers[e-i+1]=this.layers[e-i];this.layers[t]=a}else if(e<t){for(var n=1;n<=t-e;n++)this.layers[e-1+n]=this.layers[parseFloat(e)+n];this.layers[t]=a}this.changeCurrentlySelectedLayerIndex(t),this.uiManager.destroyPluginElements(this.layers,this.background),this.uiManager.createPluginElements(this.layers),this.uiManager.destroyPixelCanvases(this.layers),this.uiManager.placeLayerCanvasesInDiva(this.layers),this.uiManager.placeLayerCanvasesInDiva(this.background),this.uiManager.highlightLayerSelectorById(this.layers[this.selectedLayerIndex].layerId),this.redrawAllLayers()}},{key:"onKeyUp",value:function(e){var t=this.selectedLayerIndex,a=e.keyCode?e.keyCode:e.which;if(a>=49&&a<=57){try{this.uiManager.highlightLayerSelectorById(a-49+1)}catch(e){e instanceof p.CannotSelectLayerException&&alert(e.message)}t!==this.selectedLayerIndex&&this.mousePressed&&(this.layerChangedMidDraw=!0)}switch(e.key.toLowerCase()){case"shift":this.shiftDown=!1;break;case"h":this.layers[this.selectedLayerIndex].toggleLayerActivation()}}},{key:"onKeyDown",value:function(e){switch(e.key.toLowerCase()){case"[":console.log(this.selectedLayerIndex),0!==this.selectedLayerIndex&&this.reorderLayers(this.selectedLayerIndex,this.selectedLayerIndex-1);break;case"]":this.selectedLayerIndex!==this.layers.length-1&&this.reorderLayers(this.selectedLayerIndex,this.selectedLayerIndex+1);break;case"escape":null!==this.selection&&null===this.selection.imageData&&this.selection.clearSelection(this.core.getSettings().maxZoomLevel);break;case"backspace":try{(e.ctrlKey||e.metaKey)&&this.deleteLayer()}catch(e){e instanceof p.CannotDeleteLayerException&&alert(e.message)}break;case"n":(e.ctrlKey||e.metaKey)&&this.createLayer();break;case"z":(e.ctrlKey||e.metaKey)&&e.shiftKey?this.redoAction():(e.ctrlKey||e.metaKey)&&this.undoAction();break;case"c":(e.ctrlKey||e.metaKey)&&this.selection.copyShape(this.core.getSettings().maxZoomLevel);break;case"x":(e.ctrlKey||e.metaKey)&&this.selection.cutShape(this.core.getSettings().maxZoomLevel);break;case"v":(e.ctrlKey||e.metaKey)&&null!==this.selection&&null!==this.selection.imageData&&(this.selection.pasteShapeToLayer(this.layers[this.selectedLayerIndex]),this.selection=null,this.redrawLayer(this.layers[this.selectedLayerIndex]));break;case"shift":this.shiftDown=!0;break;case"f":this.core.publicInstance.toggleFullscreenMode();break;case"b":this.tools.setCurrentTool(this.tools.type.brush);break;case"r":this.tools.setCurrentTool(this.tools.type.rectangle);break;case"g":this.tools.setCurrentTool(this.tools.type.grab);break;case"e":this.tools.setCurrentTool(this.tools.type.erase);break;case"s":this.tools.setCurrentTool(this.tools.type.select);break;case"m":this.layers[this.selectedLayerIndex].toggleLayerActivation();break;case"h":this.layers[this.selectedLayerIndex].isActivated()&&this.layers[this.selectedLayerIndex].toggleLayerActivation()}}},{key:"editLayerName",value:function(e,t,a,i,n,r){a.removeAttribute("draggable"),a.setAttribute("draggable","false"),(13===(e.which||e.keyCode)||i)&&!1===n&&(r.updateLayerName(t.value),t.setAttribute("readonly","true"),a.setAttribute("draggable","true"))}},{key:"getMousePos",value:function(e,t){var a=e.getBoundingClientRect();return{x:t.clientX-a.left,y:t.clientY-a.top}}},{key:"onMouseDown",value:function(e){var t=document.getElementById("diva-1-outer"),a=this.getMousePos(t,e);switch(null!==this.selection&&this.selection.clearSelection(this.core.getSettings().maxZoomLevel),1===e.which&&(this.rightMousePressed=!1),3===e.which&&(this.rightMousePressed=!0),this.mousePressed=!0,this.tools.getCurrentTool()){case this.tools.type.brush:this.rightMousePressed?this.initializeBrushSizeChange(a):this.initializeNewPathInCurrentLayer(a);break;case this.tools.type.rectangle:this.initializeRectanglePreview(a);break;case this.tools.type.grab:t.style.cursor="-webkit-grabbing";break;case this.tools.type.erase:this.rightMousePressed?this.initializeBrushSizeChange(a):this.initializeNewPathInCurrentLayer(a);break;case this.tools.type.select:this.selection=new y.Selection,this.initializeRectanglePreview(a)}this.undoneActions=[]}},{key:"onMouseMove",value:function(e){var t=document.getElementById("diva-1-outer"),a=this.getMousePos(t,e);switch(this.tools.getCurrentTool()){case this.tools.type.brush:this.rightMousePressed?this.changeBrushSize(a):this.addPointToCurrentPath(a),this.uiManager.moveBrushCursor(a);break;case this.tools.type.rectangle:this.rectanglePreview(a);break;case this.tools.type.erase:this.rightMousePressed?this.changeBrushSize(a):this.addPointToCurrentPath(a),this.uiManager.moveBrushCursor(a);break;case this.tools.type.select:this.rectanglePreview(a)}}},{key:"onMouseUp",value:function(){var e=document.getElementById("diva-1-outer");switch(this.mousePressed=!1,this.rightMousePressed=!1,this.horizontalMove=!1,this.initialShiftPress=!0,this.tools.getCurrentTool()){case this.tools.type.rectangle:break;case this.tools.type.grab:e.style.cursor="-webkit-grab"}}},{key:"deleteLayer",value:function(){var e=this.layers.length;if("undefined"==typeof numberInputLayers){if(e<=1)throw new p.CannotDeleteLayerException("Must at least have one layer other than the background");this.uiManager.destroyPluginElements(this.layers,this.background),this.layers.splice(this.selectedLayerIndex,1),this.selectedLayerIndex=0,this.uiManager.createPluginElements(this.layers),this.redrawAllLayers()}}},{key:"createLayer",value:function(){if("undefined"==typeof numberInputLayers){var e=void 0;switch(this.layerIdCounter){case 1:e=new l.Colour(51,102,255,1);break;case 2:e=new l.Colour(255,51,102,1);break;case 3:e=new l.Colour(255,255,10,1);break;case 4:e=new l.Colour(2,136,0,1);break;case 5:e=new l.Colour(96,0,186,1);break;case 6:e=new l.Colour(239,143,0,1);break;case 7:e=new l.Colour(71,239,200,1);break;case 8:e=new l.Colour(247,96,229,1);break;case 9:e=new l.Colour(114,61,0,1);break;default:e=new l.Colour(parseInt(255*Math.random()),parseInt(255*Math.random()),parseInt(255*Math.random()),1)}var t=new o.Layer(this.layerIdCounter,e,"Layer "+this.layerIdCounter,this,.5);this.layerIdCounter++,this.layers.push(t),this.changeCurrentlySelectedLayerIndex(this.layers.length-1),this.uiManager.destroyPluginElements(this.layers,this.background),this.uiManager.createPluginElements(this.layers),this.redrawAllLayers()}}},{key:"redoAction",value:function(){if(this.undoneActions.length>0){var e=this.undoneActions[this.undoneActions.length-1];if(!e.layer.isActivated())return;switch(e.object.type){case"path":e.layer.addPathToLayer(e.object);break;case"shape":e.layer.addShapeToLayer(e.object);break;case"selection":e.layer.addToPastedRegions(e.object)}this.undoneActions.splice(this.undoneActions.length-1,1),this.redrawLayer(e.layer)}}},{key:"undoAction",value:function(){if(this.actions.length>0){var e=this.actions[this.actions.length-1];if(!e.layer.isActivated())return;this.undoneActions.push(e),this.removeActionAtIndex(this.actions.length-1)}}},{key:"removeActionAtIndex",value:function(e){if(this.actions.length>0&&this.actions.length>=e){var t=this.actions[e];this.removeAction(t)}}},{key:"removeAction",value:function(e){if(null!==e){switch(e.object.type){case"path":e.layer.removePathFromLayer(e.object);break;case"shape":e.layer.removeShapeFromLayer(e.object);break;case"selection":e.layer.removeSelectionFromLayer(e.object)}this.redrawLayer(e.layer)}}},{key:"initializeNewPathInCurrentLayer",value:function(e){if(this.layers[this.selectedLayerIndex].isActivated()&&this.core.getSettings().currentPageIndex===this.layers[0].pageIndex){var t=this.core.getSettings().currentPageIndex,a=this.core.getSettings().zoomLevel,i=this.core.getSettings().renderer,n=(new r.Point).getRelativeCoordinatesFromPadded(t,i,e.x,e.y,a);if(this.uiManager.isInPageBounds(n.x,n.y)){var s=this.layers[this.selectedLayerIndex],o=new r.Point(n.x,n.y,t),l=this.uiManager.getBrushSizeSelectorValue();this.lastRelCoordX=n.x,this.lastRelCoordY=n.y,this.tools.getCurrentTool()===this.tools.type.brush?(s.createNewPath(l,"add"),s.addToCurrentPath(o,"add")):this.tools.getCurrentTool()===this.tools.type.erase&&(s.createNewPath(l,"subtract"),s.addToCurrentPath(o,"subtract")),a=this.core.getSettings().maxZoomLevel,s.getCurrentPath().connectPoint(s,o,t,a,!1,this.core.getSettings().renderer,s.getCanvas(),"page")}else this.mousePressed=!1}}},{key:"addPointToCurrentPath",value:function(e){if(this.layers[this.selectedLayerIndex].isActivated()&&this.core.getSettings().currentPageIndex===this.layers[0].pageIndex&&this.mousePressed){var t=void 0,a=this.core.getSettings().currentPageIndex,i=this.core.getSettings().zoomLevel,n=this.core.getSettings().renderer,s=(new r.Point).getRelativeCoordinatesFromPadded(a,n,e.x,e.y,i);if(this.uiManager.isInPageBounds(s.x,s.y))if(this.layerChangedMidDraw)this.initializeNewPathInCurrentLayer(e),this.layerChangedMidDraw=!1;else{var o=this.core.getSettings().currentPageIndex,l=this.core.getSettings().maxZoomLevel;switch(this.mousePressed&&this.shiftDown?(this.initialShiftPress&&(Math.abs(s.x-this.lastRelCoordX)>=Math.abs(s.y-this.lastRelCoordY)&&(this.horizontalMove=!0),this.initialShiftPress=!1),t=this.horizontalMove?new r.Point(s.x,this.lastRelCoordY,o):new r.Point(this.lastRelCoordX,s.y,o)):(this.horizontalMove=!1,this.initialShiftPress=!0,this.lastRelCoordX=s.x,this.lastRelCoordY=s.y,t=new r.Point(s.x,s.y,o)),this.tools.getCurrentTool()){case this.tools.type.brush:this.layers[this.selectedLayerIndex].addToCurrentPath(t,"add");break;case this.tools.type.erase:this.layers[this.selectedLayerIndex].addToCurrentPath(t,"subtract");break;default:this.layers[this.selectedLayerIndex].addToCurrentPath(t,"add")}var c=this.layers[this.selectedLayerIndex];c.getCurrentPath().connectPoint(c,t,o,l,!0,this.core.getSettings().renderer,c.getCanvas(),"page")}}}},{key:"initializeRectanglePreview",value:function(e){if(this.layers[this.selectedLayerIndex].isActivated()&&this.core.getSettings().currentPageIndex===this.layers[0].pageIndex){var t=this.core.getSettings().currentPageIndex,a=this.core.getSettings().zoomLevel,i=this.core.getSettings().renderer,n=(new r.Point).getRelativeCoordinatesFromPadded(t,i,e.x,e.y,a);if(this.uiManager.isInPageBounds(n.x,n.y)){var o=this.layers[this.selectedLayerIndex];switch(this.tools.getCurrentTool()){case this.tools.type.select:o.addShapeToLayer(new s.Rectangle(new r.Point(n.x,n.y,t),0,0,"select",this.tools.getCurrentTool())),this.selection.setSelectedShape(o.getCurrentShape(),this.layers[this.selectedLayerIndex]);break;case this.tools.type.rectangle:this.rightMousePressed?o.addShapeToLayer(new s.Rectangle(new r.Point(n.x,n.y,t),0,0,"subtract",this.tools.getCurrentTool())):o.addShapeToLayer(new s.Rectangle(new r.Point(n.x,n.y,t),0,0,"add",this.tools.getCurrentTool()))}this.redrawLayer(o)}}}},{key:"rectanglePreview",value:function(e){if(this.layers[this.selectedLayerIndex].isActivated()&&this.core.getSettings().currentPageIndex===this.layers[0].pageIndex)if(this.layerChangedMidDraw)this.layerChangedMidDraw=!1,this.initializeRectanglePreview(e);else{if(!this.mousePressed)return;var t=this.core.getSettings().currentPageIndex,a=this.core.getSettings().zoomLevel,i=this.core.getSettings().renderer,n=(new r.Point).getRelativeCoordinatesFromPadded(t,i,e.x,e.y,a),s=this.layers[this.selectedLayerIndex].getCurrentShape();if(!this.uiManager.isInPageBounds(n.x,n.y))return;var o=s.relativeRectWidth;if(s.relativeRectWidth=n.x-s.origin.relativeOriginX,this.shiftDown){var l=void 0;l=this.isInMainDiagonal(n,s)?1:-1,this.uiManager.isInPageBounds(s.origin.relativeOriginX+s.relativeRectWidth,s.origin.relativeOriginY+l*s.relativeRectWidth)?s.relativeRectHeight=l*s.relativeRectWidth:s.relativeRectWidth=o}else s.relativeRectHeight=n.y-s.origin.relativeOriginY;this.redrawLayer(this.layers[this.selectedLayerIndex])}}},{key:"initializeBrushSizeChange",value:function(e){var t=document.getElementById("brush-size-selector");this.prevMouseX=e.x,this.prevSize=t.value}},{key:"changeBrushSize",value:function(e){var t=document.getElementById("brush-size-selector"),a=.1*(parseFloat(e.x)-parseFloat(this.prevMouseX));t.value=parseFloat(this.prevSize)+a,this.uiManager.resizeBrushCursor()}},{key:"isInMainDiagonal",value:function(e,t){return e.x<t.origin.relativeOriginX&&e.y<t.origin.relativeOriginY||e.x>t.origin.relativeOriginX&&e.y>t.origin.relativeOriginY}},{key:"redrawLayer",value:function(e){e.drawLayer(this.core.getSettings().maxZoomLevel,e.getCanvas())}},{key:"redrawAllLayers",value:function(){var e=this;this.layers.forEach(function(t){e.redrawLayer(t)})}},{key:"changeCurrentlySelectedLayerIndex",value:function(e){this.selectedLayerIndex=e,null!==this.selection&&null===this.selection.imageData&&this.selection.clearSelection(this.core.getSettings().maxZoomLevel)}},{key:"exportAsImageData",value:function(){var e=this.core.getSettings().currentPageIndex,t=this.core.getSettings().zoomLevel;new c.Export(this,this.layers,e,t,this.uiManager).exportLayersAsImageData()}},{key:"exportAsPNG",value:function(){var e=this.core.getSettings().currentPageIndex,t=this.core.getSettings().zoomLevel;new c.Export(this,this.layers,e,t,this.uiManager).exportLayersAsPNG()}},{key:"exportAsCSV",value:function(){var e=this.core.getSettings().currentPageIndex,t=this.core.getSettings().maxZoomLevel;new c.Export(this,this.layers,e,t,this.uiManager).exportLayersAsCSV()}},{key:"importPNGToLayer",value:function(e){new h.Import(this,this.layers,this.core.getSettings().currentPageIndex,this.core.getSettings().zoomLevel,this.uiManager).uploadLocalImageToLayer(this.layers[this.selectedLayerIndex],e)}}]),t}();t.default=v,v.prototype.pluginName="pixel",v.prototype.isPageTool=!0,window.Diva.PixelPlugin=v}).call(this,a(6))},function(e,t){var a;a=function(){return this}();try{a=a||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(a=window)}e.exports=a},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PixelWrapper=void 0;var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}(),n=a(2),r=a(0),s=a(3),o=a(1);t.PixelWrapper=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pixelInstance=t,this.layers=t.layers,this.totalRegionCount,this.uiManager=t.uiManager,this.pageIndex=t.core.getSettings().currentPageIndex,this.zoomLevel=t.core.getSettings().zoomLevel,this.exportInterrupted=!1,this.selectRegionLayer,this.selectedWholePage=!1,this.maxZoom=t.core.getSettings().maxZoomLevel,this.maxWidth=t.core.publicInstance.getPageDimensionsAtZoomLevel(this.pageIndex,this.maxZoom).width,this.maxHeight=t.core.publicInstance.getPageDimensionsAtZoomLevel(this.pageIndex,this.maxZoom).height}return i(e,[{key:"activate",value:function(){this.createLayers(),this.createButtons(),this.rodanImagesToCanvas(),this.createTooltip(),this.addListeners()}},{key:"deactivate",value:function(){this.destroyButtons()}},{key:"addListeners",value:function(){var e=this;document.addEventListener("keydown",function(t){if(0===e.pixelInstance.selectedLayerIndex){if("a"===t.key.toLowerCase()&&t.shiftKey)e.selectedWholePage=!0;else{if(27!==t.keyCode)return;e.selectedWholePage=!1}var a=e.selectedWholePage?"add":"subtract",i=new n.Rectangle(new r.Point(0,0,e.pageIndex),e.maxWidth,e.maxHeight,a);e.selectRegionLayer.addShapeToLayer(i),e.pixelInstance.redrawLayer(e.selectRegionLayer)}})}},{key:"createTooltip",value:function(){var e=document.getElementById("layer--1-selector"),t=document.createElement("div"),a=document.createTextNode("?"),i=document.createElement("div");t.setAttribute("class","tooltip"),t.appendChild(a),i.setAttribute("class","tooltiptext"),i.innerHTML="<p>While in the Select Region Layer, use the rectangle tool to select the regions of the page that you will classify.</p><p>Once you select these regions, select another layer and begin classifying! Keep in mind that classification outside these regions will not be utilized.</p><p>You can select the entire page by pressing <b>SHIFT + A</b>.</p><p>You can deselect the entire page by pressing <b>ESC</b>. This will destroy all selection regions that you have created.</p>",t.appendChild(i),e.appendChild(t)}},{key:"createButtons",value:function(){var e=this,t=document.createElement("button"),a=document.createTextNode("Submit To Rodan");this.exportToRodan=function(){e.createBackgroundLayer()},t.setAttribute("id","rodan-export-button"),t.appendChild(a),t.addEventListener("click",this.exportToRodan),document.body.insertBefore(t,document.getElementById("imageLoader"))}},{key:"destroyButtons",value:function(){var e=document.getElementById("rodan-export-button");e.parentNode.removeChild(e)}},{key:"createLayers",value:function(){if(this.pixelInstance.tools.currentTool="rectangle",1===this.layers.length){var e=numberInputLayers;if(0===numberInputLayers)for(;e<=0||e>7;)e=parseInt(prompt("How many layers will you classify?\nThis must be two (2) less than the total number of output ports.",3));this.selectRegionLayer=new s.Layer(-1,new o.Colour(240,232,227,1),"Select Region",this.pixelInstance,.3),this.layers.unshift(this.selectRegionLayer);for(var t=2;t<e+1;t++){var a=void 0;switch(t){case 2:a=new o.Colour(255,51,102,1);break;case 3:a=new o.Colour(255,255,10,1);break;case 4:a=new o.Colour(2,136,0,1);break;case 5:a=new o.Colour(96,0,186,1);break;case 6:a=new o.Colour(239,143,0,1);break;case 7:a=new o.Colour(71,239,200,1)}var i=new s.Layer(t,a,"Layer "+t,this.pixelInstance,.5);this.layers.push(i)}this.pixelInstance.layerIdCounter=this.layers.length,this.uiManager.destroyPluginElements(this.layers,this.pixelInstance.background),this.uiManager.createPluginElements(this.layers)}}},{key:"exportLayersToRodan",value:function(){console.log("Exporting!"),this.layers.push(this.selectRegionLayer);var e=this.layers.length,t=[];this.layers.forEach(function(a){console.log(a.layerId+" "+a.layerName);var i=a.getCanvas().toDataURL();t.push(i),0===(e-=1)&&(console.log(t),console.log("done"),$.ajax({url:"",type:"POST",data:JSON.stringify({user_input:t}),contentType:"application/json",success:function(){setTimeout(function(){alert("Submission successful! Click OK to exit Pixel.js.")},1e3),setTimeout(function(){window.close()},1200)},error:function(e,t,a){console.log(e),console.log(t),console.log(a),alert("An error occurred: "+a)}}))})}},{key:"createBackgroundLayer",value:function(){var e=this;this.layers.shift(),this.layersCount=this.layers.length;var t=new s.Layer(0,new o.Colour(242,0,242,1),"Background Layer",this.pixelInstance,.5,this.pixelInstance.actions);if(this.selectRegionLayer.shapes.forEach(function(a){var i=a.origin.getCoordsInPage(e.maxZoom).x,s=a.origin.getCoordsInPage(e.maxZoom).y,o=a.relativeRectWidth*Math.pow(2,e.maxZoom),l=a.relativeRectHeight*Math.pow(2,e.maxZoom),c=new n.Rectangle(new r.Point(i,s,e.pageIndex),o,l,"add");"subtract"===a.blendMode&&c.changeBlendModeTo("subtract"),t.addShapeToLayer(c)}),t.drawLayer(this.maxZoom,t.getCanvas()),0===this.selectRegionLayer.shapes.length)return alert("You haven't created any select regions!"),void this.layers.unshift(this.selectRegionLayer);this.selectRegionLayer.drawLayerInPageCoords(this.maxZoom,t.getCanvas(),this.pageIndex);var a=t.getCtx();a.globalCompositeOperation="destination-out",this.layers.forEach(function(t){var i=document.createElement("canvas");i.setAttribute("class","export-page-canvas"),i.setAttribute("id","layer-"+t.layerId+"-export-canvas"),i.setAttribute("style","position: absolute; top: 0; left: 0;"),i.width=e.maxWidth,i.height=e.maxHeight,t.drawLayerInPageCoords(e.maxZoom,i,e.pageIndex),0!==t.layerId&&a.drawImage(i,0,0)}),this.layers.unshift(t),this.exportLayersToRodan()}},{key:"rodanImagesToCanvas",value:function(){var e=this;this.layers.forEach(function(t){var a=document.getElementById("layer"+t.layerId+"-img");if(null!==a){var i=document.createElement("canvas");i.width=t.getCanvas().width,i.height=t.getCanvas().height;var n=i.getContext("2d");n.drawImage(a,0,0);for(var r=n.getImageData(0,0,t.getCanvas().width,t.getCanvas().height),s=r.data,o=0;o<s.length;o+=4)s[o]=t.colour.red,s[o+1]=t.colour.green,s[o+2]=t.colour.blue;n.putImageData(r,0,0),t.backgroundImageCanvas=i,t.drawLayer(e.pixelInstance.core.getSettings().maxZoomLevel,t.getCanvas())}})}}]),e}()},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Shape=void 0;var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}(),n=a(0),r=a(1);t.Shape=function(){function e(t,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.origin=t,this.type="shape",this.blendMode=a}return i(e,[{key:"drawInViewport",value:function(){}},{key:"drawOnPage",value:function(){}},{key:"changeBlendModeTo",value:function(e){this.blendMode=e}},{key:"getPixels",value:function(e,t,a,i,s,o,l,c,d){for(var u=s.getContext("2d"),h=o.getContext("2d"),y=c;y<l;y++){for(var g=[],p=0;p<d.length;p++)for(var v=0;v<d[p].length-1;v++){var m=d[p][v].absolutePaddedX,b=d[p][v].absolutePaddedY,f=d[p][v+1].absolutePaddedX,x=d[p][v+1].absolutePaddedY,k=m+(f-m)/(x-b)*(y-b),w=Math.round(k);(b<=y&&x>y||x<=y&&b>y)&&g.push({absolutePaddedX:w,absolutePaddedY:y})}if(g.sort(function(e,t){return e.absolutePaddedX-t.absolutePaddedX}),!(g.length<=0))for(var C=0;C<g.length-1;C++)if(C%2==0)for(var I=g[C].absolutePaddedX,L=g[C+1].absolutePaddedX,E=g[C].absolutePaddedY,P=I;P<L;P++){var A=(new n.Point).getAbsoluteCoordinatesFromPadded(t,i,P,E);if("add"===this.blendMode){if(A.y>=0&&A.x>=0&&A.y<=s.height&&A.x<=s.width){var M=(new n.Point).getPaddedCoordinatesFromAbsolute(t,i,A.x,A.y),S=h.getImageData(M.x,M.y,1,1).data,T=new r.Colour(S[0],S[1],S[2],S[3]);u.fillStyle=T.toHTMLColour(),u.fillRect(A.x,A.y,1,1)}}else"subtract"===this.blendMode&&u.clearRect(A.x,A.y,1,1)}}}}]),e}()},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}();t.Path=function(){function e(t,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.points=[],this.brushSize=t,this.type="path",this.blendMode=a,this.lastAbsX=0,this.lastAbsY=0}return i(e,[{key:"addPointToPath",value:function(e){this.points.push(e)}},{key:"drawInViewport",value:function(e,t,a,i,n){var r=this,s=!1;this.points.forEach(function(o){r.connectPoint(e,o,t,a,s,i,n,"viewport"),s=!0})}},{key:"drawOnPage",value:function(e,t,a,i,n){var r=this,s=!1;this.points.forEach(function(o){r.connectPoint(e,o,t,a,s,i,n,"page"),s=!0})}},{key:"connectPoint",value:function(e,t,a,i,n,r,s,o){var l=Math.pow(2,i),c=s.getContext("2d");if(a===t.pageIndex){var d=void 0;switch(o){case"viewport":d=t.getCoordsInViewport(i,a,r);break;case"page":d=t.getCoordsInPage(i);break;default:d=t.getCoordsInViewport(i,a,r)}var u=d.x,h=d.y;n&&("add"===this.blendMode?(c.globalCompositeOperation="source-over",c.beginPath(),c.strokeStyle=e.colour.toHTMLColour(),c.lineWidth=this.brushSize*l,c.lineJoin="round",c.moveTo(this.lastAbsX,this.lastAbsY),c.lineTo(u,h),c.closePath(),c.stroke()):"subtract"===this.blendMode&&(c.globalCompositeOperation="destination-out",c.beginPath(),c.strokeStyle="rgba(250,250,250,1)",c.lineWidth=this.brushSize*l,c.lineJoin="round",c.moveTo(this.lastAbsX,this.lastAbsY),c.lineTo(u,h),c.closePath(),c.stroke()),c.globalCompositeOperation="source-over"),this.lastAbsX=u,this.lastAbsY=h}}}]),e}()},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Action=function e(t,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.object=t,this.layer=a}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Export=void 0;var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}(),n=a(1),r=a(0);t.Export=function(){function e(t,a,i,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pixelInstance=t,this.layers=a,this.exportLayersCount=a.length,this.interrupted=!1,this.dataCanvases=[],this.pageIndex=i,this.zoomLevel=n,this.matrix=null,this.uiManager=r}return i(e,[{key:"exportLayersAsImageData",value:function(){var e=this;this.dataCanvases=[];var t=this.pixelInstance.core.publicInstance.getPageDimensionsAtZoomLevel(this.pageIndex,this.zoomLevel).height,a=this.pixelInstance.core.publicInstance.getPageDimensionsAtZoomLevel(this.pageIndex,this.zoomLevel).width,i=this.uiManager.createExportElements(this).progressCanvas;this.layers.forEach(function(n){var r=document.createElement("canvas");r.setAttribute("class","export-page-canvas"),r.setAttribute("id","layer-"+n.layerId+"-export-canvas"),r.setAttribute("style","position: absolute; top: 0; left: 0;"),r.width=a,r.height=t,n.drawLayerInPageCoords(e.zoomLevel,r,e.pageIndex);var s=document.createElement("canvas");s.setAttribute("class","export-page-data-canvas"),s.setAttribute("id","layer-"+n.layerId+"-export-canvas"),s.setAttribute("value",n.layerName),s.setAttribute("style","position: absolute; top: 0; left: 0;"),s.width=a,s.height=t,e.dataCanvases.push(s),e.getImageData(e.pixelInstance.core.getSettings().renderer._canvas,s,e.pageIndex,r,i)})}},{key:"exportLayersAsCSV",value:function(){var e=this,t=this.pixelInstance.core,a=t.publicInstance.getPageDimensionsAtZoomLevel(this.pageIndex,this.zoomLevel).height,i=t.publicInstance.getPageDimensionsAtZoomLevel(this.pageIndex,this.zoomLevel).width,n=this.uiManager.createExportElements(this).progressCanvas;this.initializeMatrix(),this.exportLayersCount=this.layers.length,this.layers.forEach(function(t){var r=document.createElement("canvas");r.setAttribute("class","export-page-canvas"),r.setAttribute("id","layer-"+t.layerId+"-export-canvas"),r.width=i,r.height=a,t.drawLayerInPageCoords(e.zoomLevel,r,e.pageIndex),e.fillMatrix(t,e.matrix,r,n)})}},{key:"exportLayersAsPNG",value:function(){var e=document.getElementById("png-links-div");null!==e&&e.parentElement.removeChild(e),(e=document.createElement("div")).setAttribute("id","png-links-div"),this.layers.forEach(function(t){t.getCanvas().toBlob(function(a){var i=document.createTextNode("Download "+t.layerName+" PNG "),n=document.getElementById(t.layerName+"-png-download");if(null===n){var r=document.createElement("img"),s=URL.createObjectURL(a);r.src=s,(n=document.createElement("a")).appendChild(i),e.appendChild(n)}var o=URL.createObjectURL(a);n.setAttribute("class","export-download"),n.setAttribute("id",t.layerName+"-png-download"),n.setAttribute("href",o),n.setAttribute("download",t.layerName)})}),document.body.appendChild(e)}},{key:"getImageData",value:function(e,t,a,i,r){var s=this,o=i.width,l=0,c=0,d=0,u=i.getContext("2d"),h=this.pixelInstance.core.getSettings().renderer;!function y(){var g=o;for(l++;g--&&!(c>=i.height);)if(d<i.width){var p=u.getImageData(d,c,1,1).data;0!==new n.Colour(p[0],p[1],p[2],p[3]).alpha&&s.drawImageDataOnCanvas(c,d,a,h,e,t,r),d++}else c++,d=0;s.postProcessImageDataIteration(c,t,l,o,i).needsRecall&&setTimeout(y,1)}()}},{key:"drawImageDataOnCanvas",value:function(e,t,a,i,s,o,l){var c=o.getContext("2d"),d=s.getContext("2d"),u=l.getContext("2d"),h=(new r.Point).getPaddedCoordinatesFromAbsolute(a,i,t,e);h.y<0?i.goto(a,e,t):h.y>s.height?i.goto(a,e+s.height,t):h.x<0?i.goto(a,e,t):h.x>s.width&&i.goto(a,e,t+s.width);var y=d.getImageData(h.x,h.y,1,1).data,g=new n.Colour(y[0],y[1],y[2],y[3]);c.fillStyle=g.toHTMLColour(),c.fillRect(t,e,1,1),u.fillStyle=g.toHTMLColour(),u.fillRect(t,e,1,1)}},{key:"postProcessImageDataIteration",value:function(e,t,a,i,n){if((e===n.height||this.exportInterrupted)&&(this.exportLayersCount-=1),e<n.height&&!this.exportInterrupted){var r=a*i*100/(n.height*n.width),s=r>100?100:Math.round(10*r)/10;return this.pixelInstance.uiManager.updateProgress(s),{needsRecall:!0}}return this.exportInterrupted&&0===this.exportLayersCount?(this.exportInterrupted=!1,this.uiManager.destroyExportElements()):this.exportInterrupted||(t.toBlob(function(e){var a=document.createTextNode("Download "+t.getAttribute("value")+" image data "),i=document.getElementById(t.getAttribute("value")+"-image-data-download");if(null===i){var n=document.createElement("img"),r=URL.createObjectURL(e);n.src=r,(i=document.createElement("a")).appendChild(a),document.body.appendChild(i)}var s=URL.createObjectURL(e);i.setAttribute("class","export-download"),i.setAttribute("id",t.getAttribute("value")+"-image-data-download"),i.setAttribute("href",s),i.setAttribute("download",t.getAttribute("value")+" image data")}),0===this.exportLayersCount&&this.uiManager.destroyExportElements()),{needsRecall:!1}}},{key:"fillMatrix",value:function(e,t,a,i){var n=this,r=a.width,s=3,o=i.getContext("2d"),l=a.getContext("2d").getImageData(0,0,a.width,a.height).data;!function i(){var c=r;for(0;c--&&!(s>l.length);){if(0!==l[s]){var d=Math.floor(s/4),u=parseInt(d/a.height),h=parseInt(d%a.width);t[u][h]=e.layerId,o.fillStyle=e.colour.toHTMLColour(),o.fillRect(h,u,1,1)}s+=4}if(s>=l.length||n.exportInterrupted)n.exportLayersCount-=1;else{var y=s/l.length*100,g=y>100?100:Math.round(10*y)/10;n.pixelInstance.uiManager.updateProgress(g),setTimeout(i,1)}0===n.exportLayersCount&&(n.uiManager.destroyExportElements(),n.exportInterrupted?n.exportInterrupted=!1:n.transformMatrixToCSV())}()}},{key:"initializeMatrix",value:function(){var e=this.pixelInstance.core,t=e.publicInstance.getPageDimensionsAtZoomLevel(this.pageIndex,this.zoomLevel).height,a=e.publicInstance.getPageDimensionsAtZoomLevel(this.pageIndex,this.zoomLevel).width;this.matrix=new Array(t).fill(null).map(function(){return new Array(a).fill(0)})}},{key:"transformMatrixToCSV",value:function(){for(var e="",t=0;t<this.matrix.length;t++){e+=this.matrix[t].join(","),e+="\n"}var a=new Blob([e],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(a,"pixel-export");else{var i=document.createTextNode("Download CSV "),n=document.getElementById("csv-download");null===n&&((n=document.createElement("a")).appendChild(i),document.body.appendChild(n));var r=URL.createObjectURL(a);n.setAttribute("class","export-download"),n.setAttribute("id","csv-download"),n.setAttribute("href",r),n.setAttribute("download","pixel-export")}}},{key:"printMatrixOnCanvas",value:function(e){for(var t=this,a=this.matrix[0].length,i=e.getContext("2d"),n=function(e,a){t.layers.forEach(function(n){n.layerId===t.matrix[e][a]&&(i.fillStyle=n.colour.toHTMLColour(),i.fillRect(a,e,1,1))})},r=0;r<this.matrix.length;r++)for(var s=0;s<a;s++)0!==this.matrix[r][s]&&n(r,s)}}]),e}()},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UIManager=void 0;var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}(),n=a(0),r=a(4);t.UIManager=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pixelInstance=t,this.mouse={x:0,y:0,startX:0,startY:0}}return i(e,[{key:"createPluginElements",value:function(e){this.placeLayerCanvasesInDiva(e),this.createUndoButton(),this.createRedoButton(),"undefined"==typeof numberInputLayers&&(this.createDeleteLayerButton(),this.createCreateLayerButton()),this.createLayersView(e),this.createToolsView(this.pixelInstance.tools.getAllTools()),this.createExportButtons(),this.createImportButtons()}},{key:"destroyPluginElements",value:function(e,t){this.destroyLayerSelectors(e),this.destroyBrushSizeSelector(),this.destroyUndoButton(),this.destroyRedoButton(),"undefined"==typeof numberInputLayers&&(this.destroyDeleteLayerButton(),this.destroyCreateLayerButton()),this.destroyExportButtons(),this.destroyImportButtons(),this.destroyPixelCanvases(e),this.destroyToolsView(this.pixelInstance.tools.getAllTools()),this.destroyLockedLayerSelectors(t),this.destroyDownloadLinks(),this.destroyBrushCursor(),this.restoreDefaultCursor()}},{key:"createToolsView",value:function(e){var t=this,a=document.createElement("form");a.setAttribute("id","tool-selector"),a.setAttribute("class","tool-selector");for(var i=function(e){e.addEventListener("click",function(){t.pixelInstance.tools.setCurrentTool(e.value)})},n=0;n<e.length;n++){var r=e[n],s=document.createElement("input"),o=document.createElement("label");o.setAttribute("for",r),o.innerHTML=r,s.setAttribute("id",r),s.setAttribute("type","radio"),s.setAttribute("value",r),s.setAttribute("name","tool-selector"),s.setAttribute("class","radio-select"),i(s),a.appendChild(s),a.appendChild(o)}document.body.appendChild(a),this.pixelInstance.tools.setCurrentTool(this.pixelInstance.tools.getCurrentTool())}},{key:"destroyToolsView",value:function(){var e=document.getElementById("tool-selector");e.parentNode.removeChild(e)}},{key:"placeLayerCanvasesInDiva",value:function(e){for(var t=this.pixelInstance.core.getSettings().renderer._canvas,a=e.length-1;a>=0;a--){var i=e[a];i.placeCanvasAfterElement(t),i.isActivated()?i.getCanvas().style.opacity=i.getLayerOpacity():i.getCanvas().style.opacity=0}this.pixelInstance.background.isActivated()?this.pixelInstance.background.getCanvas().style.opacity=this.pixelInstance.background.getLayerOpacity():this.pixelInstance.background.getCanvas().style.opacity=0}},{key:"destroyPixelCanvases",value:function(e){e.forEach(function(e){null!==e.getCanvas().parentNode&&e.getCanvas().parentNode.removeChild(e.getCanvas())})}},{key:"createOpacitySlider",value:function(e,t,a){var i=document.createElement("br"),n=document.createElement("div"),r=document.createElement("p"),s=document.createElement("input"),o=document.createTextNode("Opacity");i.setAttribute("id","opacity-br-"+e.layerId),n.setAttribute("class","layer-tool"),n.setAttribute("id","layer-"+e.layerId+"-opacity-tool"),r.setAttribute("class","layer-tool-text"),r.setAttribute("id","layer-"+e.layerId+"-opacity-text"),s.setAttribute("class","layer-tool-slider"),s.setAttribute("id","layer-"+e.layerId+"-opacity-slider"),s.setAttribute("type","range"),s.setAttribute("max",50),s.setAttribute("min",0),s.setAttribute("value",50*e.getLayerOpacity()),s.setAttribute("draggable","false"),s.addEventListener("input",function(){e.setLayerOpacity(s.value/50),e.isActivated()&&(e.getCanvas().style.opacity=e.getLayerOpacity())}),r.appendChild(o),n.appendChild(r),n.appendChild(s),t.insertBefore(n,a.nextSibling),t.insertBefore(i,a.nextSibling)}},{key:"destroyOpacitySlider",value:function(e){var t=document.getElementById("layer-"+e.layerId+"-opacity-tool"),a=document.getElementById("opacity-br-"+e.layerId);t.parentElement.removeChild(t),a.parentElement.removeChild(a)}},{key:"createBackground",value:function(){var e=document.createElement("div");e.setAttribute("id","background-view"),e.setAttribute("class","background-view");var t=this.pixelInstance.background,a=document.createElement("div"),i=document.createElement("div"),n=document.createElement("input"),r=document.createElement("div"),s=document.createElement("div");a.setAttribute("draggable","false"),a.setAttribute("class","layer-div"),a.setAttribute("value",t.layerId),a.setAttribute("id","layer-"+t.layerId+"-selector"),n.setAttribute("type","text"),n.setAttribute("readonly","true"),n.setAttribute("value",t.layerName),i.setAttribute("class","color-box"),i.setAttribute("style","background-color: "+t.colour.toHexString()+";"),r.setAttribute("class","unchecked-layer-settings"),r.setAttribute("id","layer-"+t.layerId+"-options"),this.pixelInstance.background.isActivated()?(s.setAttribute("class","layer-activated"),this.pixelInstance.background.getCanvas().style.opacity=1):(s.setAttribute("class","layer-deactivated"),this.pixelInstance.background.getCanvas().style.opacity=0),s.setAttribute("id","layer-"+t.layerId+"-activation"),i.addEventListener("click",function(){t.displayColourOptions()}),s.addEventListener("click",function(){t.toggleLayerActivation()}),r.onclick=function(){t.displayLayerOptions()},a.appendChild(n),a.appendChild(r),a.appendChild(i),a.appendChild(s),e.appendChild(a),document.body.appendChild(e)}},{key:"destroyLockedLayerSelectors",value:function(){var e=document.getElementById("background-view");e.parentNode.removeChild(e)}},{key:"createLayersView",value:function(e){var t=this,a=void 0,i=void 0,n=!1,r=document.createElement("div");r.setAttribute("id","layers-view"),r.setAttribute("class","layers-view");for(var s=function(){var s=e[o],l=document.createElement("div"),c=document.createElement("br"),d=document.createElement("div"),u=document.createElement("input"),h=document.createElement("div"),y=document.createElement("div");l.setAttribute("index",o),l.setAttribute("draggable","true"),l.setAttribute("class","layer-div"),l.setAttribute("value",s.layerId),l.setAttribute("id","layer-"+s.layerId+"-selector"),l.setAttribute("title","Hotkey: "+s.layerId),u.setAttribute("type","text"),u.setAttribute("readonly","true"),u.setAttribute("value",s.layerName),u.setAttribute("ondblclick","this.readOnly='';"),u.addEventListener("dblclick",function(e){t.pixelInstance.editLayerName(e,u,l,!1,n,s),u.onblur=function(e){t.pixelInstance.editLayerName(e,u,l,!0,n,s)}}),d.setAttribute("class","color-box"),d.setAttribute("style","background-color: "+s.colour.toHexString()+";"),h.setAttribute("class","unchecked-layer-settings"),h.setAttribute("id","layer-"+s.layerId+"-options"),s.isActivated()?y.setAttribute("class","layer-activated"):y.setAttribute("class","layer-deactivated"),y.setAttribute("id","layer-"+s.layerId+"-activation"),s.layerId===t.pixelInstance.layers[t.pixelInstance.selectedLayerIndex].layerId&&l.classList.add("selected-layer"),function(e,r,s,o,l,c){r.addEventListener("click",function(){e.displayColourOptions()}),s.addEventListener("click",function(){e.toggleLayerActivation()}),o.addEventListener("keypress",function(a){t.pixelInstance.editLayerName(a,o,c,!1,n,e)}),l.onclick=function(){e.displayLayerOptions()},c.ondrag=function(e){t.pixelInstance.dragging(e),n=!0},c.ondragstart=function(e){t.pixelInstance.dragStart(e)},c.ondrop=function(e){t.pixelInstance.drop(e,a,i),n=!1},c.onmousedown=function(){a=c.getAttribute("index"),t.highlightLayerSelectorById(e.layerId)},c.ondragover=function(e){t.pixelInstance.allowDrop(e),i=c.getAttribute("index")}}(s,d,y,u,h,l),l.appendChild(u),l.appendChild(h),l.appendChild(d),l.appendChild(y),r.appendChild(l),r.appendChild(c)},o=e.length-1;o>=0;o--)s();document.body.appendChild(r),this.createBackground(e)}},{key:"destroyLayerSelectors",value:function(){var e=document.getElementById("layers-view");e.parentNode.removeChild(e)}},{key:"highlightLayerSelectorById",value:function(e){var t=this,a=!1;if(this.pixelInstance.layers.forEach(function(t){t.layerId===e&&(a=!0)}),!a)throw new r.CannotSelectLayerException("The layer you are trying to select does not exist.");this.pixelInstance.layers.forEach(function(a){if(a.layerId===e){var i=document.getElementById("layer-"+a.layerId+"-selector");i.hasAttribute("selected-layer")||i.classList.add("selected-layer"),t.pixelInstance.changeCurrentlySelectedLayerIndex(t.pixelInstance.layers.indexOf(a))}else{var n=document.getElementById("layer-"+a.layerId+"-selector");n.classList.contains("selected-layer")&&n.classList.remove("selected-layer")}})}},{key:"createBrushSizeSelector",value:function(){var e=this,t=document.createElement("div");t.setAttribute("class","tool-settings"),t.setAttribute("id","brush-size");var a=document.createTextNode("Brush size:"),i=document.createElement("input");i.setAttribute("id","brush-size-selector"),i.setAttribute("type","range"),i.setAttribute("max",40),i.setAttribute("min",1),i.setAttribute("value",25),i.addEventListener("input",function(){e.createBrushCursor()}),t.appendChild(a),t.appendChild(i),document.body.appendChild(t)}},{key:"destroyBrushSizeSelector",value:function(){var e=document.getElementById("brush-size");null!==e&&e.parentNode.removeChild(e)}},{key:"createUndoButton",value:function(){var e=this,t=document.createElement("button"),a=document.createTextNode("Undo");this.undo=function(){e.pixelInstance.undoAction()},t.setAttribute("id","undo-button"),t.appendChild(a),t.addEventListener("click",this.undo),document.body.appendChild(t)}},{key:"destroyUndoButton",value:function(){var e=document.getElementById("undo-button");e.parentNode.removeChild(e)}},{key:"createRedoButton",value:function(){var e=this,t=document.createElement("button"),a=document.createTextNode("Redo");this.redo=function(){e.pixelInstance.redoAction()},t.setAttribute("id","redo-button"),t.appendChild(a),t.addEventListener("click",this.redo),document.body.appendChild(t)}},{key:"destroyRedoButton",value:function(){var e=document.getElementById("redo-button");e.parentNode.removeChild(e)}},{key:"createDeleteLayerButton",value:function(){var e=this,t=document.createElement("button"),a=document.createTextNode("Delete selected layer");this.deleteLayer=function(){try{e.pixelInstance.deleteLayer()}catch(e){e instanceof r.CannotDeleteLayerException&&alert(e.message)}},t.setAttribute("id","delete-layer-button"),t.appendChild(a),t.addEventListener("click",this.deleteLayer),document.body.appendChild(t)}},{key:"destroyDeleteLayerButton",value:function(){var e=document.getElementById("delete-layer-button");e.parentNode.removeChild(e)}},{key:"createCreateLayerButton",value:function(){var e=this,t=document.createElement("button"),a=document.createTextNode("Create new layer");this.createLayer=function(){e.pixelInstance.createLayer()},t.setAttribute("id","create-layer-button"),t.appendChild(a),t.addEventListener("click",this.createLayer),document.body.appendChild(t)}},{key:"destroyCreateLayerButton",value:function(){var e=document.getElementById("create-layer-button");e.parentNode.removeChild(e)}},{key:"createExportButtons",value:function(){var e=this,t=document.createElement("button"),a=document.createTextNode("Export as CSV"),i=document.createElement("button"),n=document.createTextNode("Export as PNG"),r=document.createElement("button"),s=document.createTextNode("Export as image Data PNG");this.exportCSV=function(){e.pixelInstance.exportAsCSV()},this.exportPNG=function(){e.pixelInstance.exportAsPNG()},this.exportPNGData=function(){e.pixelInstance.exportAsImageData()},t.setAttribute("id","csv-export-button"),t.appendChild(a),t.addEventListener("click",this.exportCSV),i.setAttribute("id","png-export-button"),i.appendChild(n),i.addEventListener("click",this.exportPNG),r.setAttribute("id","png-export-data-button"),r.appendChild(s),r.addEventListener("click",this.exportPNGData),document.body.appendChild(t),document.body.appendChild(i),document.body.appendChild(r)}},{key:"destroyExportButtons",value:function(){var e=document.getElementById("csv-export-button"),t=document.getElementById("png-export-button"),a=document.getElementById("png-export-data-button");e.parentNode.removeChild(e),t.parentNode.removeChild(t),a.parentNode.removeChild(a)}},{key:"createImportButtons",value:function(){var e=this,t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("id","imageLoader"),t.setAttribute("name","imageLoader"),this.import=function(t){e.pixelInstance.importPNGToLayer(t)},t.addEventListener("change",this.import,!1),document.body.appendChild(t)}},{key:"destroyImportButtons",value:function(){var e=document.getElementById("imageLoader");e.parentNode.removeChild(e)}},{key:"updateProgress",value:function(e){var t=e+"%",a="width: "+t;document.getElementById("pbar-inner-div").setAttribute("style",a),document.getElementById("pbar-inner-text").innerHTML=t}},{key:"destroyBackground",value:function(e){this.pixelInstance.destroyLockedLayerSelectors(e)}},{key:"createExportElements",value:function(e){var t=document.createElement("div"),a=document.createTextNode("Exporting"),i=document.createTextNode("0%"),n=document.createElement("div"),r=document.createElement("div"),s=document.createElement("div"),o=document.createElement("div"),l=document.createElement("div"),c=document.createTextNode("Cancel");return t.setAttribute("class","export-div"),t.setAttribute("id","pixel-export-div"),n.setAttribute("class","pbar-outer-div"),n.setAttribute("id","pbar-outer-div"),r.setAttribute("class","pbar-inner-div"),r.setAttribute("id","pbar-inner-div"),s.setAttribute("class","pbar-inner-text"),s.setAttribute("id","pbar-inner-text"),o.setAttribute("class","pbar-export-text"),o.setAttribute("id","pbar-export-text"),l.setAttribute("class","cancel-export-div"),l.setAttribute("id","cancel-export-div"),l.addEventListener("click",function(){l.setAttribute("style","background-color: #AAAAAA;"),e.exportInterrupted=!0}),o.appendChild(a),l.appendChild(c),s.appendChild(i),n.appendChild(r),n.appendChild(s),n.appendChild(o),n.appendChild(l),t.appendChild(n),document.body.appendChild(t),{progressCanvas:this.createProgressCanvas(e.pageIndex,e.zoomLevel)}}},{key:"destroyExportElements",value:function(){var e=document.getElementById("pixel-export-div");e.parentNode.removeChild(e)}},{key:"destroyDownloadLinks",value:function(){for(var e=document.getElementsByClassName("export-download");e[0];)e[0].parentNode.removeChild(e[0])}},{key:"createProgressCanvas",value:function(e,t){var a=this.pixelInstance.core.publicInstance.getPageDimensionsAtZoomLevel(e,t).height,i=this.pixelInstance.core.publicInstance.getPageDimensionsAtZoomLevel(e,t).width,n=document.createElement("canvas");n.setAttribute("id","progress-canvas"),n.style.opacity=.3,n.width=i,n.height=a,n.globalAlpha=1;var r=window,s=document,o=s.documentElement,l=s.getElementsByTagName("body")[0],c=r.innerHeight||o.clientHeight||l.clientHeight;return n.style.height=c+"px",document.getElementById("pixel-export-div").appendChild(n),n}},{key:"markToolSelected",value:function(e){document.getElementById(e).checked=!0}},{key:"getBrushSizeSelectorValue",value:function(){var e=document.getElementById("brush-size-selector"),t=e.value/e.max*10;return.05+Math.exp(t-6)}},{key:"createBrushCursor",value:function(){var e=document.getElementById("brush-cursor-div"),t=document.getElementById("diva-1-viewport"),a=document.getElementById("diva-1-outer");null===e&&((e=document.createElement("div")).setAttribute("id","brush-cursor-div"),a.insertBefore(e,t)),e.setAttribute("oncontextmenu","return false"),this.resizeBrushCursor()}},{key:"resizeBrushCursor",value:function(){var e=document.getElementById("brush-cursor-div");if(null!==e){var t=Math.pow(2,this.pixelInstance.core.getSettings().zoomLevel),a=this.getBrushSizeSelectorValue()*t;e.style.width=a+"px",e.style.height=a+"px"}}},{key:"destroyBrushCursor",value:function(){var e=document.getElementById("brush-cursor-div");null!==e&&e.parentNode.removeChild(e)}},{key:"moveBrushCursor",value:function(e){var t=document.getElementById("brush-cursor-div"),a=Math.pow(2,this.pixelInstance.core.getSettings().zoomLevel),i=this.getBrushSizeSelectorValue()*a;t.style.left=e.x-i/2-1+"px",t.style.top=e.y-i/2-1+"px"}},{key:"restoreDefaultCursor",value:function(){document.getElementById("diva-1-outer").style.cursor="default"}},{key:"setMousePosition",value:function(e){this.mouse.x=e.x-1,this.mouse.y=e.y-1}},{key:"createRectanglePreview",value:function(e,t){this.setMousePosition(e);var a=document.getElementById("diva-1-viewport"),i=document.getElementById("diva-1-outer");this.mouse.startX=this.mouse.x,this.mouse.startY=this.mouse.y;var n=document.createElement("div");n.className="rectangle",n.id="preview-rectangle",n.style.left=this.mouse.x+"px",n.style.top=this.mouse.y+"px",n.style.border="1px solid "+t.colour.toHexString(),i.insertBefore(n,a)}},{key:"resizeRectanglePreview",value:function(e,t){this.setMousePosition(e);var a=document.getElementById("preview-rectangle");null!==a&&(a.style.border="1px solid "+t.colour.toHexString(),a.style.width=Math.abs(this.mouse.x-this.mouse.startX)+"px",a.style.height=Math.abs(this.mouse.y-this.mouse.startY)+"px",a.style.left=this.mouse.x-this.mouse.startX<0?this.mouse.x+"px":this.mouse.startX+"px",a.style.top=this.mouse.y-this.mouse.startY<0?this.mouse.y+"px":this.mouse.startY+"px")}},{key:"removeRectanglePreview",value:function(){var e=document.getElementById("preview-rectangle");null!==e&&e.parentNode.removeChild(e)}},{key:"isInPageBounds",value:function(e,t){var a=this.pixelInstance.core.getSettings().currentPageIndex,i=this.pixelInstance.core.getSettings().zoomLevel,r=this.pixelInstance.core.getSettings().renderer,s=this.pixelInstance.core.publicInstance.getCurrentPageDimensionsAtCurrentZoomLevel(),o=(new n.Point).getCoordsInViewport(i,a,r),l=s.width+o.x,c=s.height+o.y,d=(new n.Point).getRelativeCoordinatesFromPadded(a,r,l,c,i);return!(e<0||t<0||e>d.x||t>d.y)}},{key:"tutorial",value:function(){var e=document.createElement("div");e.setAttribute("id","tutorial-div");var t=document.createElement("div");t.setAttribute("id","tutorial-overlay");var a=document.createElement("div");a.setAttribute("id","myModal"),a.setAttribute("class","modal");var i=document.createElement("div");i.setAttribute("class","modal-content");var n=document.createElement("div");n.setAttribute("class","modal-header");var r=document.createTextNode("Hello, World"),s=document.createElement("h2");s.appendChild(r);var o=document.createElement("span");o.setAttribute("class","close"),o.innerHTML="&times;";var l=document.createElement("div");l.setAttribute("class","modal-body");var c=document.createElement("p");c.innerHTML="The following is a glossary of the hotkeys you will find useful when using Pixel.js";var d=document.createElement("ul");d.setAttribute("style","list-style-type:none;");var u=document.createElement("li");u.innerHTML="<kbd>1</kbd> ... <kbd>9</kbd> layer select";var h=document.createElement("li");h.innerHTML="<kbd>b</kbd> brush tool";var y=document.createElement("li");y.innerHTML="<kbd>r</kbd> rectangle tool";var g=document.createElement("li");g.innerHTML="<kbd>g</kbd> grab tool";var p=document.createElement("li");p.innerHTML="<kbd>e</kbd> eraser tool";var v=document.createElement("li");v.innerHTML="<kbd>Shift</kbd>  force tools to paint in an exact way.";var m=document.createElement("li");m.innerHTML="<kbd>cmd</kbd> + <kbd>z</kbd> undo";var b=document.createElement("li");b.innerHTML="<kbd>cmd</kbd> + <kbd>Shift</kbd> + <kbd>z</kbd> redo";var f=document.createElement("div");f.setAttribute("class","modal-footer");var x=document.createElement("h2");x.innerHTML="Got It!",d.appendChild(u),d.appendChild(h),d.appendChild(y),d.appendChild(g),d.appendChild(p),d.appendChild(v),d.appendChild(m),d.appendChild(b),a.appendChild(i),i.appendChild(n),i.appendChild(l),i.appendChild(f),n.appendChild(s),n.appendChild(o),l.appendChild(c),l.appendChild(d),f.appendChild(x),e.appendChild(t),e.appendChild(a),document.body.appendChild(e),a.style.display="block",f.addEventListener("click",function(){e.parentNode.removeChild(e)})}}]),e}()},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}();t.Tools=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pixelInstance=t,this.type={brush:"brush",rectangle:"rectangle",grab:"grab",erase:"erase",select:"select"},this.currentTool=this.type.brush}return i(e,[{key:"getAllTools",value:function(){var e=[];for(var t in this.type)e.push(t);return e}},{key:"setCurrentTool",value:function(e){switch(this.currentTool){case this.type.grab:this.pixelInstance.disableDragScrollable();break;case this.type.brush:case this.type.erase:case this.type.rectangle:this.pixelInstance.uiManager.destroyBrushCursor()}this.currentTool=e,this.pixelInstance.uiManager.markToolSelected(e);var t=document.getElementById("diva-1-outer"),a=document.getElementById("brush-size");switch(null===a&&(this.pixelInstance.uiManager.createBrushSizeSelector(),a=document.getElementById("brush-size")),e){case this.type.grab:this.pixelInstance.enableDragScrollable(),a.style.visibility="hidden",t.style.cursor="-webkit-grab";break;case this.type.rectangle:a.style.visibility="hidden",t.style.cursor="crosshair";break;case this.type.brush:case this.type.erase:a.style.visibility="visible",this.pixelInstance.uiManager.createBrushCursor(),t.style.cursor="none";break;case this.type.select:a.style.visibility="hidden",t.style.cursor="crosshair";break;default:t.style.cursor="default"}}},{key:"getCurrentTool",value:function(){return this.currentTool}}]),e}()},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}();t.Import=function(){function e(t,a,i,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pixelInstance=t,this.layers=a,this.exportInterrupted=!1,this.pageIndex=i,this.zoomLevel=n,this.matrix=null,this.uiManager=r}return i(e,[{key:"uploadLocalImageToLayer",value:function(e,t){var a=this,i=new FileReader;i.onload=function(t){a.importFromImageURLToLayer(e,t.target.result)},i.readAsDataURL(t.target.files[0])}},{key:"importFromImageURLToLayer",value:function(e,t){var a=this,i=document.createElement("canvas");i.width=e.getCanvas().width,i.height=e.getCanvas().height;var n=i.getContext("2d"),r=new Image;r.src=t,r.onload=function(){n.drawImage(r,0,0);for(var t=n.getImageData(0,0,e.getCanvas().width,e.getCanvas().height),s=t.data,o=0;o<s.length;o+=4)s[o]=e.colour.red,s[o+1]=e.colour.green,s[o+2]=e.colour.blue;n.putImageData(t,0,0),e.setBackgroundImageCanvas(i),e.drawLayer(a.pixelInstance.core.getSettings().maxZoomLevel,e.getCanvas())}}}]),e}()},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}();t.Selection=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.layer=null,this.selectedShape=null,this.type="selection",this.imageData=null}return i(e,[{key:"copyShape",value:function(e){this.layer.removeShapeFromLayer(this.selectedShape),this.layer.drawLayer(e,this.layer.getCanvas());var t=Math.pow(2,e),a=this.selectedShape.origin.relativeOriginX*t,i=this.selectedShape.origin.relativeOriginY*t,n=this.selectedShape.relativeRectWidth*t,r=this.selectedShape.relativeRectHeight*t,s=Math.min(a,a+n),o=Math.min(i,i+r),l=this.layer.getCanvas().getContext("2d").getImageData(s,o,Math.abs(n),Math.abs(r));this.imageData=l,this.selectedShape.changeBlendModeTo("add")}},{key:"cutShape",value:function(e){this.layer.removeShapeFromLayer(this.selectedShape),this.layer.drawLayer(e,this.layer.getCanvas());var t=Math.pow(2,e),a=this.selectedShape.origin.relativeOriginX*t,i=this.selectedShape.origin.relativeOriginY*t,n=this.selectedShape.relativeRectWidth*t,r=this.selectedShape.relativeRectHeight*t,s=Math.min(a,a+n),o=Math.min(i,i+r),l=this.layer.getCanvas().getContext("2d").getImageData(s,o,Math.abs(n),Math.abs(r));this.imageData=l,this.selectedShape.changeBlendModeTo("subtract"),this.layer.addShapeToLayer(this.selectedShape),this.layer.drawLayer(e,this.layer.getCanvas())}},{key:"pasteShapeToLayer",value:function(e){for(var t=this.imageData.data,a=0;a<t.length;a+=4)t[a]=e.colour.red,t[a+1]=e.colour.green,t[a+2]=e.colour.blue;e.addToPastedRegions(this)}},{key:"setSelectedShape",value:function(e,t){this.selectedShape=e,this.layer=t}},{key:"clearSelection",value:function(e){null!==this.layer&&null!==this.selectedShape&&("select"===this.selectedShape.blendMode&&this.layer.removeShapeFromLayer(this.selectedShape),this.layer.drawLayer(e,this.layer.getCanvas()))}},{key:"drawOnPage",value:function(e,t,a,i,n){var r=Math.pow(2,a),s=this.selectedShape.origin.relativeOriginX*r,o=this.selectedShape.origin.relativeOriginY*r,l=this.selectedShape.relativeRectWidth*r,c=this.selectedShape.relativeRectHeight*r,d=Math.min(s,s+l),u=Math.min(o,o+c),h=document.createElement("canvas");h.width=Math.abs(l),h.height=Math.abs(c),h.getContext("2d").putImageData(this.imageData,0,0),n.getContext("2d").drawImage(h,d,u)}}]),e}()},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}();t.Tutorial=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pixelInstance=t,this.currentTutorialPageIndex=0,this.modalContent=document.createElement("div"),this.createTutorial()}return i(e,[{key:"createTutorial",value:function(){var e=document.createElement("div");e.setAttribute("id","tutorial-div");var t=document.createElement("div");t.setAttribute("id","tutorial-overlay");var a=document.createElement("div");a.setAttribute("id","myModal"),a.setAttribute("class","modal"),this.modalContent.setAttribute("class","modal-content");var i=document.createElement("div");i.setAttribute("class","modal-header");var n=document.createTextNode("Tutorial"),r=document.createElement("h2");r.appendChild(n);var s=document.createElement("span");s.setAttribute("class","close"),s.innerHTML="&times;";var o=this.getModalBody(this.currentTutorialPageIndex),l=document.createElement("div");l.setAttribute("class","modal-footer"),l.setAttribute("id","modal-footer");var c=document.createElement("h2");c.innerHTML="Got It!",a.appendChild(this.modalContent),this.modalContent.appendChild(i),this.modalContent.appendChild(o),this.modalContent.appendChild(l),i.appendChild(r),i.appendChild(s),l.appendChild(c),e.appendChild(t),e.appendChild(a),document.body.appendChild(e),a.style.display="block",l.addEventListener("click",function(){e.parentNode.removeChild(e)})}},{key:"getModalBody",value:function(e){var t=this,a=document.createElement("div");a.setAttribute("class","modal-body"),a.setAttribute("id","modal-body");var i=document.createElement("p"),n=new Image;n.className="tutorial-image";var r=document.createElement("button");r.innerHTML="Next";var s=document.createElement("button");s.innerHTML="Previous";var o=document.createElement("p");switch(o.setAttribute("id","tutorial-progress"),o.innerHTML=e+1+"/16",r.addEventListener("click",function(){t.currentTutorialPageIndex++,t.getTutorialPage(t.currentTutorialPageIndex)}),s.addEventListener("click",function(){t.currentTutorialPageIndex--,t.getTutorialPage(t.currentTutorialPageIndex)}),e){case 0:i.innerHTML="Navigate to the page you would like to edit and click the Pixel.js icon to open the toolboxes and layers view.",n.src="https://github.com/DDMAL/Pixel.js/wiki/assets/01.gif";break;case 1:i.innerHTML="Each layer has its own specific colour and represents a classification category. Create as many layers as needed. <br> A collection of keyboard shortcuts have been implemented. Each layer can be selected by its number (from <kbd>1</kbd> to <kbd>9</kbd>). Hover over the layers to receive a prompt.",n.src="https://github.com/DDMAL/Pixel.js/wiki/assets/02.gif";break;case 2:i.innerHTML="You can upload images to the currently selected layer. The image will be converted to the specified layer's colour. <br> In this example, we have uploaded the output images of a classification method in order to correct it.",n.src="https://github.com/DDMAL/Pixel.js/wiki/assets/03.gif";break;case 3:i.innerHTML="Double click on the layer's name to rename it.",n.src="https://github.com/DDMAL/Pixel.js/wiki/assets/04.gif";break;case 4:i.innerHTML="Use zoom along with the grab tool <kbd>g</kbd> to navigate a page.",n.src="https://github.com/DDMAL/Pixel.js/wiki/assets/06.gif";break;case 5:i.innerHTML="Use the select tool <kbd>s</kbd> to copy <kbd>Ctrl</kbd> + <kbd>c</kbd> or cut <kbd>Ctrl</kbd> + <kbd>x</kbd> and paste <kbd>Ctrl</kbd> + <kbd>v</kbd> rectangular regions of pixels from one layer to another.",n.src="https://github.com/DDMAL/Pixel.js/wiki/assets/07.gif";break;case 6:i.innerHTML="Right-click and drag right and left on the erase <kbd>e</kbd> and brush <kbd>b</kbd> tools to change the brush size.",n.src="https://github.com/DDMAL/Pixel.js/wiki/assets/09.gif";break;case 7:i.innerHTML="Press <kbd>Shift</kbd> and drag on the erase <kbd>e</kbd> and brush <kbd>b</kbd> tools to draw straight lines.",n.src="https://github.com/DDMAL/Pixel.js/wiki/assets/10.gif";break;case 8:i.innerHTML="Right-click and drag on rectangle tool <kbd>r</kbd> to erase rectangular regions, left-click to draw rectangle. Press <kbd>Shift</kbd> to draw squares.",n.src="https://github.com/DDMAL/Pixel.js/wiki/assets/08.gif";break;case 9:i.innerHTML="Use the Fullscreen mode <kbd>f</kbd> and the browser zoom to get more precision, when needed. <br> To exit Fullscreen mode, press on <kbd>f</kbd> again.",n.src="https://github.com/DDMAL/Pixel.js/wiki/assets/fullscreen.gif";break;case 10:i.innerHTML="You can bring a layer forward/backward by clicking and dragging them to their desired position.",n.src="https://github.com/DDMAL/Pixel.js/wiki/assets/11.gif";break;case 11:i.innerHTML="You can undo <kbd>Ctrl</kbd> + <kbd>z</kbd> and redo <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>z</kbd> an action.",n.src="https://github.com/DDMAL/Pixel.js/wiki/assets/undo_redo.gif";break;case 12:i.innerHTML="You can delete a layer by selecting it and then using <kbd>Ctrl</kbd> + <kbd>del</kbd>.",n.src="https://github.com/DDMAL/Pixel.js/wiki/assets/delete_layer.gif";break;case 13:i.innerHTML="You can mute (press <kbd>m</kbd> to toggle on/off) or hide (hold <kbd>h</kbd> to turn off, release to turn on) layers.",n.src="https://github.com/DDMAL/Pixel.js/wiki/assets/12_layers_on_off.gif";break;case 14:i.innerHTML="Change the opacity of a layer by displaying the layer options.",n.src="https://github.com/DDMAL/Pixel.js/wiki/assets/05.gif";break;case 15:i.innerHTML='Export layers as PNGs to save a specific layer as an image. See the <a href="https://github.com/DDMAL/Pixel.js/wiki">wiki</a> for details on the different export buttons and more information.',n.src="https://github.com/DDMAL/Pixel.js/wiki/assets/21_export.gif"}return a.appendChild(n),a.appendChild(i),0!==this.currentTutorialPageIndex&&a.appendChild(s),15!==this.currentTutorialPageIndex&&a.appendChild(r),a.appendChild(o),a}},{key:"getTutorialPage",value:function(e){var t=document.getElementById("modal-body");t.parentElement.removeChild(t),this.modalContent.insertBefore(this.getModalBody(e),document.getElementById("modal-footer"))}}]),e}()}]);