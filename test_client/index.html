<!DOCTYPE html>
<html ng-app="rodanMockApp">
  <head>
    <meta charset="utf-8" />
    <title>Rodan Mock Client</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.4/angular.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min.js"></script>
    <script src="script.js"></script>
  </head>
  <body>
    <div class="container">
      <section class="row" ng-controller="projectsCtrl">
        <h1>Projects</h1>
        <div class="col-xs-8">
          <table class="table">
            <tr ng-repeat="p in projects">
              <td ng-bind="p.uuid"></td>
              <td ng-bind="p.name"></td>
            </tr>
          </table>
        </div>
        <div class="col-xs-4">
          <form ng-submit="newProject()">
            <fieldset>
              <legend>New Project</legend>
              <input type="name" placeholder="Project Name" ng-model="name"/>
              <button type="submit">Submit</button>
            </fieldset>
          </form>
        </div>
      </section>
      <section class="row" ng-controller="resourcesCtrl">
        <h1>Resources</h1>
        <div class="col-xs-8">
          <table class="table">
            <tbody>
              <tr ng-repeat="r in resources">
                <td>
                  <span ng-bind="r.uuid" ng-show="!r.compat_resource_file"></span>
                  <a ng-bind="r.uuid" ng-show="r.compat_resource_file" ng-href="{{r.compat_resource_file}}" target="_blank"></a>
                </td>
                <td ng-bind="r.name"></td>
                <td><img ng-show="r.has_thumb" ng-src="{{r.small_thumb}}" /><em ng-show="!r.has_thumb">No thumbnail</em></td>
                <td><button ng-click="deleteResource(r)">Delete</button></td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="col-xs-4">
          <form ng-submit="newResource()">
            <fieldset>
              <legend>New Resource</legend>
              <label>Project: <select ng-model="project" ng-options="p.url as p.name for p in projects"></select></label>
              <input type="file" file-model="file" />

              <button type="submit">Submit</button>
            </fieldset>
          </form>
        </div>
      </section>
      <section class="row" ng-controller="workflowsCtrl">
        <h1>Workflows</h1>
        <div class="col-xs-8">
          <table class="table">
            <tbody>
              <tr ng-repeat="w in workflows" ng-class="{success: w.valid, danger: !w.valid}">
                <td ng-bind="w.uuid"></td>
                <td ng-bind="w.name"></td>
                <td><button ng-click="validateWorkflow(w)">Validate</button><button ng-click="deleteWorkflow(w)">Delete</button><button ng-click="runWorkflow(w)">Run</button></td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="col-xs-4">
          <div><label>Project: <select ng-model="project" ng-options="p.url as p.name for p in projects"></select></label></div>
          <form ng-submit="newToGreyscaleWorkflow()">
            <fieldset>
              <legend>New to_greyscale Workflow</legend>
              <div><label>Resources: <select ng-model="resources_greyscale" ng-options="r.url as (r.name + '--' + r.uuid) for r in resources" multiple></select></label></div>
              <input type="name" placeholder="Workflow Name" ng-model="name_greyscale"/>
              <button type="submit">Submit</button>
            </fieldset>
          </form>
          <form ng-submit="newRotateCropWorkflow()">
            <fieldset>
              <legend>New rotate & crop Workflow</legend>
              <div><label>Resources: <select ng-model="resources_rotatecrop" ng-options="r.url as (r.name + '--' + r.uuid) for r in resources" multiple></select></label></div>
              <input type="name" placeholder="Workflow Name" ng-model="name_rotatecrop"/>
              <button type="submit">Submit</button>
            </fieldset>
          </form>
        </div>
      </section>
      <section class="row" ng-controller="workflowrunsCtrl">
        <h1>WorkflowRuns & RunJobs</h1>
        <div ng-repeat="wfrun in workflowruns" class="col-xs-12">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title" ng-bind="wfrun.uuid"></h3>
              For <code ng-bind="wfrun.workflow"></code>
              <b>Status: {{wfrun.status}}</b>
              <button ng-click="cancelWorkflowRun(wfrun)">Cancel</button>
            </div>
            <div class="panel-body">
              <table class="table">
                <tr ng-repeat="rj in runjobs[wfrun.url]" ng-class="{success: rj.status == 4, danger: rj.status == -1, active: rj.status == 1}">
                  <td ng-bind="rj.job_name"></td>
                  <td>
                    <p ng-bind="status[rj.status]"></p>
                    <a ng-show="rj.ready_for_input" ng-href="{{rj.interactive}}" target="_blank">Interactive</a>
                    <div ng-show="rj.status == -1">
                      <b>{{rj.error_summary}}</b>
                      <pre><code>{{rj.error_details}}</code></pre>
                    </div>
                  </td>
                </tr>
              </table>
            </div>
          </div>
        </div>
      </section>
    </div>
  </body>
</html>